!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,n){var m=null,g=null;$(n).wysihtml5({stylesheets:t.stylesheets}),a=$(".font-picker"),i=$(".background-color"),l=$(".text-color"),r=$(".highlight-color"),d=$("#editable").data("wysihtml5").editor,t.$on("loadAdditionalParams",function(t,e){u=!0,c=e,d.setValue(e.data),e.background&&(m=tinycolor(e.background),g=m.toRgb(),i.spectrum("set",m),d.composer.commands.exec("backgroundColor",g,[{name:"data-background-color",value:m.toRgbString()}])),o()}),t.$on("collectAdditionalParams",function(){m=d.composer.doc.body.getAttribute("data-background-color"),t.$parent.setAdditionalParam("data",d.getValue()),t.$parent.setAdditionalParam("background",m?m:"")}),d.on("load",function(){s=!0,e(),o()})}function o(){var t,o,e,n,i;s&&u&&$.each($(c.data).find("span").addBack(),function(){e=$(this).attr("data-standard-font"),n=$(this).attr("data-google-font"),i=$(this).attr("data-custom-font"),t=$(this).attr("data-text-color"),o=$(this).attr("data-highlight-color"),e&&d.composer.commands.exec("standardFont",e,$(this).attr("data-standard-font-family")),n&&(a.data("plugin_fontPicker").addGoogleFont(n,!1),d.composer.commands.exec("googleFont",n)),i&&(RiseVision.Common.Utilities.loadCustomFont(i,$(this).attr("data-custom-font-url"),d.composer.iframe.contentDocument),d.composer.commands.exec("customFont",i,$(this).attr("data-custom-font-url"))),t&&(l.spectrum("set",t),d.composer.commands.exec("textColor",l.spectrum("get").toRgb())),o&&(r.spectrum("set",o),d.composer.commands.exec("highlightColor",r.spectrum("get").toRgb()))})}function e(){var t,o,e=null,i=null,c=!1,s=!1,u=!1,m="",g="",p="",h="",f="";t=$(".emphasis"),o=$(".font-size-picker"),$(".font-picker").on("show.bfhselectbox",function(){n()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){n()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){n()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){n(),e=d.composer.selection.getSelectedNode(),e&&3===e.nodeType&&(i=e.parentNode,i&&1===i.nodeType&&("body"!==i.tagName.toLowerCase()?(c="bold"===window.getComputedStyle(i,null).getPropertyValue("font-weight")?!0:!1,s="italic"===window.getComputedStyle(i,null).getPropertyValue("font-style")?!0:!1,u=-1!==window.getComputedStyle(i,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,t.data("plugin_fontStyle").setStyles({bold:c,italic:s,underline:u}),m=window.getComputedStyle(i,null).getPropertyValue("font-family"),m&&a.data("plugin_fontPicker").setFont(m),g=window.getComputedStyle(i,null).getPropertyValue("font-size"),g&&o.data("plugin_fontSizePicker").setFontSize(g),p=$(i).data("line-height")?$(i).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",p),h=window.getComputedStyle(i,null).getPropertyValue("color"),f=window.getComputedStyle(i,null).getPropertyValue("background-color"),h&&l.spectrum("set",h),f&&r.spectrum("set",f)):(t.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function n(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var a,i,l,r,c,d=null,s=!1,u=!1;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJyZ2JhIiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiJHRleHRDb2xvciIsIiRoaWdobGlnaHRDb2xvciIsImVkaXRvciIsImRhdGEiLCIkb24iLCJlIiwiYWRkaXRpb25hbFBhcmFtcyIsImlzUGFyYW1zTG9hZGVkIiwicGFyYW1zIiwic2V0VmFsdWUiLCJiYWNrZ3JvdW5kIiwidGlueWNvbG9yIiwidG9SZ2IiLCJzcGVjdHJ1bSIsImNvbXBvc2VyIiwiY29tbWFuZHMiLCJleGVjIiwibmFtZSIsInZhbHVlIiwidG9SZ2JTdHJpbmciLCJpbml0RWRpdG9yIiwiZG9jIiwiYm9keSIsImdldEF0dHJpYnV0ZSIsIiRwYXJlbnQiLCJzZXRBZGRpdGlvbmFsUGFyYW0iLCJnZXRWYWx1ZSIsIm9uIiwiaXNFZGl0b3JMb2FkZWQiLCJiaW5kIiwidGV4dENvbG9yIiwiaGlnaGxpZ2h0Q29sb3IiLCJzdGFuZGFyZEZvbnQiLCJnb29nbGVGb250IiwiY3VzdG9tRm9udCIsImVhY2giLCJmaW5kIiwiYWRkQmFjayIsInRoaXMiLCJhdHRyIiwiYWRkR29vZ2xlRm9udCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJVdGlsaXRpZXMiLCJsb2FkQ3VzdG9tRm9udCIsImlmcmFtZSIsImNvbnRlbnREb2N1bWVudCIsIiRmb250U3R5bGUiLCIkZm9udFNpemVQaWNrZXIiLCJub2RlIiwicGFyZW50Tm9kZSIsImlzQm9sZCIsImlzSXRhbGljIiwiaXNVbmRlcmxpbmUiLCJmb250IiwiZm9udFNpemUiLCJsaW5lSGVpZ2h0IiwiY29sb3IiLCJjbG9zZURyb3Bkb3ducyIsImNvbnRlbnRzIiwic2VsZWN0aW9uIiwiZ2V0U2VsZWN0ZWROb2RlIiwibm9kZVR5cGUiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsImluZGV4T2YiLCJzZXRTdHlsZXMiLCJib2xkIiwiaXRhbGljIiwidW5kZXJsaW5lIiwic2V0Rm9udCIsInNldEZvbnRTaXplIiwicmVtb3ZlQ2xhc3MiLCJyZXN0cmljdCIsInNjb3BlIl0sIm1hcHBpbmdzIjoiQ0FFQyxXQUNDLFlBRUFBLFNBQVFDLE9BQU8seUNBQ1pDLFVBQVUsWUFBYSxXQU10QixRQUFTQyxHQUFLQyxFQUFRQyxHQUNwQixHQUFJQyxHQUFrQixLQUFNQyxFQUFPLElBRW5DQyxHQUFFSCxHQUFTSSxXQUNUQyxZQUFlTixFQUFPTSxjQUd4QkMsRUFBY0gsRUFBRSxnQkFDaEJJLEVBQW1CSixFQUFFLHFCQUNyQkssRUFBYUwsRUFBRSxlQUNmTSxFQUFrQk4sRUFBRSxvQkFDcEJPLEVBQVNQLEVBQUUsYUFBYVEsS0FBSyxhQUFhRCxPQUcxQ1gsRUFBT2EsSUFBSSx1QkFBd0IsU0FBVUMsRUFBR0MsR0FDOUNDLEdBQWlCLEVBQ2pCQyxFQUFTRixFQUVUSixFQUFPTyxTQUFTSCxFQUFpQkgsTUFHN0JHLEVBQWlCSSxhQUNuQmpCLEVBQWtCa0IsVUFBVUwsRUFBaUJJLFlBQzdDaEIsRUFBT0QsRUFBZ0JtQixRQUV2QmIsRUFBaUJjLFNBQVMsTUFBT3BCLEdBRWpDUyxFQUFPWSxTQUFTQyxTQUFTQyxLQUFLLGtCQUFtQnRCLElBQzdDdUIsS0FBTSx3QkFDTkMsTUFBT3pCLEVBQWdCMEIsa0JBSTdCQyxNQUdGN0IsRUFBT2EsSUFBSSwwQkFBMkIsV0FDcENYLEVBQWtCUyxFQUFPWSxTQUFTTyxJQUFJQyxLQUNuQ0MsYUFBYSx5QkFFaEJoQyxFQUFPaUMsUUFBUUMsbUJBQW1CLE9BQVF2QixFQUFPd0IsWUFDakRuQyxFQUFPaUMsUUFBUUMsbUJBQW1CLGFBQ2hDaEMsRUFBa0JBLEVBQWtCLE1BR3hDUyxFQUFP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QUFFdUQsR0FBWS9DLEtBQUssZUFBaUIsRUFFdENSLEVBQUUsdUJBQXVCUSxLQUFLLDBCQUM1QnFELEdBR0ZDLEVBQVFRLE9BQU9DLGlCQUFpQmhCLEVBQVksTUFDekNpQixpQkFBaUIsU0FDcEJwQyxFQUFpQmtDLE9BQU9DLGlCQUFpQmhCLEVBQVksTUFDbERpQixpQkFBaUIsb0JBRWhCVixHQUNGekQsRUFBV2EsU0FBUyxNQUFPNEMsR0FHekIxQixHQUNGOUIsRUFBZ0JZLFNBQVMsTUFBT2tCLEtBS2xDZ0IsRUFBVzVDLEtBQUssb0JBQW9Ca0UsV0FDbENDLE1BQVEsRUFDUkMsUUFBVSxFQUNWQyxXQUFhLElBSWY3RSxFQUFFLHVCQUF1QlEsS0FBSywwQkFBMkIsUUFRbkUsUUFBU3VELEtBQ1AvRCxFQUFFLCtHQUVDZ0YsWUFBWSxRQUNmaEYsRUFBRSxlQUFla0IsU0FBUyxRQUMxQmxCLEVBQUUsb0JBQW9Ca0IsU0FBUyxRQUMvQmxCLEVBQUUscUJBQXFCa0IsU0FBUyxRQXJPbEMsR0FDSWYsR0FBYUMsRUFBa0JDLEVBQVlDLEVBRTNDTyxFQUhBTixFQUFTLEtBRVQwQixHQUFpQixFQUFPckIsR0FBaUIsQ0FzTzdDLFFBQ0VxRSxTQUFVLElBQ1ZDLE9BQ0VoRixZQUFlLElBQ2ZhLFdBQWMsSUFDZFAsS0FBUSxLQUVWYixLQUFNQSIsImZpbGUiOiJkdHYtYm9vdHN0cmFwMy13eXNpaHRtbDUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIFJpc2VWaXNpb24sIGFuZ3VsYXIsIHRpbnljb2xvciwgJCAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBhbmd1bGFyLm1vZHVsZShcInJpc2V2aXNpb24ud2lkZ2V0LmNvbW1vbi53eXNpaHRtbDVcIiwgW10pXG4gICAgLmRpcmVjdGl2ZShcInd5c2lodG1sNVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZWRpdG9yID0gbnVsbDtcbiAgICAgIHZhciAkZm9udFBpY2tlciwgJGJhY2tncm91bmRDb2xvciwgJHRleHRDb2xvciwgJGhpZ2hsaWdodENvbG9yO1xuICAgICAgdmFyIGlzRWRpdG9yTG9hZGVkID0gZmFsc2UsIGlzUGFyYW1zTG9hZGVkID0gZmFsc2U7XG4gICAgICB2YXIgcGFyYW1zO1xuXG4gICAgICBmdW5jdGlvbiBsaW5rKCRzY29wZSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgYmFja2dyb3VuZENvbG9yID0gbnVsbCwgcmdiYSA9IG51bGw7XG5cbiAgICAgICAgJChlbGVtZW50KS53eXNpaHRtbDUoe1xuICAgICAgICAgIFwic3R5bGVzaGVldHNcIjogJHNjb3BlLnN0eWxlc2hlZXRzXG4gICAgICAgIH0pO1xuXG4gICAgICAgICRmb250UGlja2VyID0gJChcIi5mb250LXBpY2tlclwiKTtcbiAgICAgICAgJGJhY2tncm91bmRDb2xvciA9ICQoXCIuYmFja2dyb3VuZC1jb2xvclwiKTtcbiAgICAgICAgJHRleHRDb2xvciA9ICQoXCIudGV4dC1jb2xvclwiKTtcbiAgICAgICAgJGhpZ2hsaWdodENvbG9yID0gJChcIi5oaWdobGlnaHQtY29sb3JcIik7XG4gICAgICAgIGVkaXRvciA9ICQoXCIjZWRpdGFibGVcIikuZGF0YShcInd5c2lodG1sNVwiKS5lZGl0b3I7XG5cbiAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzLlxuICAgICAgICAkc2NvcGUuJG9uKFwibG9hZEFkZGl0aW9uYWxQYXJhbXNcIiwgZnVuY3Rpb24gKGUsIGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgICBpc1BhcmFtc0xvYWRlZCA9IHRydWU7XG4gICAgICAgICAgcGFyYW1zID0gYWRkaXRpb25hbFBhcmFtcztcblxuICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShhZGRpdGlvbmFsUGFyYW1zLmRhdGEpO1xuXG4gICAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgY29sb3IuXG4gICAgICAgICAgaWYgKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gdGlueWNvbG9yKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCk7XG4gICAgICAgICAgICByZ2JhID0gYmFja2dyb3VuZENvbG9yLnRvUmdiKCk7XG5cbiAgICAgICAgICAgICRiYWNrZ3JvdW5kQ29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgYmFja2dyb3VuZENvbG9yKTtcblxuICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJiYWNrZ3JvdW5kQ29sb3JcIiwgcmdiYSwgW3tcbiAgICAgICAgICAgICAgICBuYW1lOiBcImRhdGEtYmFja2dyb3VuZC1jb2xvclwiLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBiYWNrZ3JvdW5kQ29sb3IudG9SZ2JTdHJpbmcoKVxuICAgICAgICAgICAgICB9XSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaW5pdEVkaXRvcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJG9uKFwiY29sbGVjdEFkZGl0aW9uYWxQYXJhbXNcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gZWRpdG9yLmNvbXBvc2VyLmRvYy5ib2R5XG4gICAgICAgICAgICAuZ2V0QXR0cmlidXRlKFwiZGF0YS1iYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiZGF0YVwiLCBlZGl0b3IuZ2V0VmFsdWUoKSk7XG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiYmFja2dyb3VuZFwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID8gYmFja2dyb3VuZENvbG9yIDogXCJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVkaXRvci5vbihcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaXNFZGl0b3JMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgIGJpbmQoKTtcbiAgICAgICAgICBpbml0RWRpdG9yKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBpbml0RWRpdG9yKCkge1xuICAgICAgICB2YXIgdGV4dENvbG9yLCBoaWdobGlnaHRDb2xvcjtcbiAgICAgICAgdmFyIHN0YW5kYXJkRm9udCwgZ29vZ2xlRm9udCwgY3VzdG9tRm9udDtcblxuICAgICAgICBpZiAoaXNFZGl0b3JMb2FkZWQgJiYgaXNQYXJhbXNMb2FkZWQpIHtcbiAgICAgICAgICAkLmVhY2goJChwYXJhbXMuZGF0YSkuZmluZChcInNwYW5cIikuYWRkQmFjaygpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHN0YW5kYXJkRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udFwiKTtcbiAgICAgICAgICAgIGdvb2dsZUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWdvb2dsZS1mb250XCIpO1xuICAgICAgICAgICAgY3VzdG9tRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnRcIik7XG4gICAgICAgICAgICB0ZXh0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXRleHQtY29sb3JcIik7XG4gICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9ICQodGhpcykuYXR0cihcImRhdGEtaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBzdGFuZGFyZCBmb250cy5cbiAgICAgICAgICAgIGlmIChzdGFuZGFyZEZvbnQpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJzdGFuZGFyZEZvbnRcIiwgc3RhbmRhcmRGb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udC1mYW1pbHlcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBHb29nbGUgZm9udHMuXG4gICAgICAgICAgICBpZiAoZ29vZ2xlRm9udCkge1xuICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAuYWRkR29vZ2xlRm9udChnb29nbGVGb250LCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgLy8gVGhpcyB3b24ndCBhZGQgYSBuZXcgc3BhbiB0YWcgYmVjYXVzZSBhIHJhbmdlIHdpbGwgbm90IGhhdmVcbiAgICAgICAgICAgICAgLy8gYmVlbiBzZWxlY3RlZCwgd2hpY2ggaXMgd2hhdCB3ZSB3YW50LlxuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImdvb2dsZUZvbnRcIiwgZ29vZ2xlRm9udCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYWQgYW5kIGFkZCBDU1MgZm9yIGN1c3RvbSBmb250cy5cbiAgICAgICAgICAgIGlmIChjdXN0b21Gb250KSB7XG4gICAgICAgICAgICAgIFJpc2VWaXNpb24uQ29tbW9uLlV0aWxpdGllcy5sb2FkQ3VzdG9tRm9udChjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpLFxuICAgICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5pZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJjdXN0b21Gb250XCIsIGN1c3RvbUZvbnQsXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1jdXN0b20tZm9udC11cmxcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBjb2xvcnMuXG4gICAgICAgICAgICBpZiAodGV4dENvbG9yKSB7XG4gICAgICAgICAgICAgIC8vIFVzZSBjb2xvciBwaWNrZXIgYXMgYW4gaW50ZXJtZWRpYXJ5IHRvIGdldCB0aGUgY29sb3IgYXMgYW5cbiAgICAgICAgICAgICAgLy8gb2JqZWN0IGZvciBwYXNzaW5nIHRvIHRoZSBlZGl0b3IgY29tbWFuZC5cbiAgICAgICAgICAgICAgJHRleHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCB0ZXh0Q29sb3IpO1xuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcInRleHRDb2xvclwiLFxuICAgICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJnZXRcIikudG9SZ2IoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICAvLyBVc2UgY29sb3IgcGlja2VyIGFzIGFuIGludGVybWVkaWFyeS5cbiAgICAgICAgICAgICAgJGhpZ2hsaWdodENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJoaWdobGlnaHRDb2xvclwiLFxuICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcImdldFwiKS50b1JnYigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBiaW5kKCkge1xuICAgICAgICB2YXIgbm9kZSA9IG51bGwsIHBhcmVudE5vZGUgPSBudWxsO1xuICAgICAgICB2YXIgaXNCb2xkID0gZmFsc2UsIGlzSXRhbGljID0gZmFsc2UsIGlzVW5kZXJsaW5lID0gZmFsc2U7XG4gICAgICAgIHZhciBmb250ID0gXCJcIiwgZm9udFNpemUgPSBcIlwiLCBsaW5lSGVpZ2h0ID0gXCJcIjtcbiAgICAgICAgdmFyIGNvbG9yID0gXCJcIiwgaGlnaGxpZ2h0Q29sb3IgPSBcIlwiO1xuICAgICAgICB2YXIgJGZvbnRTdHlsZSwgJGZvbnRTaXplUGlja2VyO1xuXG4gICAgICAgICRmb250U3R5bGUgPSAkKFwiLmVtcGhhc2lzXCIpO1xuICAgICAgICAkZm9udFNpemVQaWNrZXIgPSAkKFwiLmZvbnQtc2l6ZS1waWNrZXJcIik7XG5cbiAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzIHRvIHRvb2xiYXIgYW5kIGVkaXRvci5cbiAgICAgICAgJChcIi5mb250LXBpY2tlclwiKS5vbihcInNob3cuYmZoc2VsZWN0Ym94XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIuZm9udC1zaXplLXBpY2tlciwgLmxpbmUtaGVpZ2h0LCAuYWxpZ25tZW50XCIpLm9uKFwic2hvdy5icy5kcm9wZG93blwiLFxuICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgJChcIi50ZXh0LWNvbG9yLCAuaGlnaGxpZ2h0LWNvbG9yLCAuYmFja2dyb3VuZC1jb2xvclwiKVxuICAgICAgICAgIC5vbihcImJlZm9yZVNob3dcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBXaGVuIHRoZSB1c2VyIGNsaWNrcyBpbiB0aGUgZWRpdG9yLCBzZXQgdG9vbGJhciB0byBtYXRjaCB0ZXh0IHN0eWxlcy5cbiAgICAgICAgJChcIi53eXNpaHRtbDUtc2FuZGJveFwiKS5jb250ZW50cygpLmZpbmQoXCJib2R5XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcblxuICAgICAgICAgIG5vZGUgPSBlZGl0b3IuY29tcG9zZXIuc2VsZWN0aW9uLmdldFNlbGVjdGVkTm9kZSgpO1xuXG4gICAgICAgICAgLy8gVGhlIHNlbGVjdGVkIG5vZGUgaXMgYSB0ZXh0IG5vZGUuXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIGFuIGVsZW1lbnQuXG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgIC8vIFRoZSBwYXJlbnQgbm9kZSBpcyBub3QgdGhlIGVkaXRvciBlbGVtZW50IGl0c2VsZi5cbiAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcImJvZHlcIikge1xuICAgICAgICAgICAgICAgIC8vIEZvbnQgU3R5bGVcbiAgICAgICAgICAgICAgICBpc0JvbGQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXdlaWdodFwiKSA9PT0gXCJib2xkXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNJdGFsaWMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXN0eWxlXCIpID09PSBcIml0YWxpY1wiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzVW5kZXJsaW5lID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwidGV4dC1kZWNvcmF0aW9uXCIpLmluZGV4T2YoXCJ1bmRlcmxpbmVcIikgIT09IC0xID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5zZXRTdHlsZXMoe1xuICAgICAgICAgICAgICAgICAgXCJib2xkXCI6IGlzQm9sZCxcbiAgICAgICAgICAgICAgICAgIFwiaXRhbGljXCI6IGlzSXRhbGljLFxuICAgICAgICAgICAgICAgICAgXCJ1bmRlcmxpbmVcIjogaXNVbmRlcmxpbmVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEZvbnRcbiAgICAgICAgICAgICAgICBmb250ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC1mYW1pbHlcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udCkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpLnNldEZvbnQoZm9udCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRm9udCBzaXplXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXNpemVcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICRmb250U2l6ZVBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRTaXplUGlja2VyXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGb250U2l6ZShmb250U2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTGluZSBIZWlnaHRcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgP1xuICAgICAgICAgICAgICAgICAgJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgOiAxO1xuXG4gICAgICAgICAgICAgICAgJChcIi5saW5lLWhlaWdodCBidXR0b25cIikuZGF0YShcInd5c2lodG1sNS1jb21tYW5kLXZhbHVlXCIsXG4gICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIC8vIENvbG9yc1xuICAgICAgICAgICAgICAgIGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiY29sb3JcIik7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAkdGV4dENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGZvbnQgc3R5bGUuXG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5zZXRTdHlsZXMoe1xuICAgICAgICAgICAgICAgICAgXCJib2xkXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgXCJpdGFsaWNcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBcInVuZGVybGluZVwiOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgbGluZSBoZWlnaHQuXG4gICAgICAgICAgICAgICAgJChcIi5saW5lLWhlaWdodCBidXR0b25cIikuZGF0YShcInd5c2lodG1sNS1jb21tYW5kLXZhbHVlXCIsIDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2xvc2UgYWxsIG9wZW4gZHJvcGRvd25zLlxuICAgICAgZnVuY3Rpb24gY2xvc2VEcm9wZG93bnMoKSB7XG4gICAgICAgICQoXCIub3Blbi5hbGlnbm1lbnQsIC5mb250LXBpY2tlciAub3Blbi5iZmgtc2VsZWN0Ym94LCBcIiArXG4gICAgICAgICAgXCIuZm9udC1zaXplLXBpY2tlciAub3Blbi5iZmgtZm9udHNpemVzLCAub3Blbi5saW5lLWhlaWdodFwiKVxuICAgICAgICAgIC5yZW1vdmVDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICQoXCIudGV4dC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICAgICQoXCIuaGlnaGxpZ2h0LWNvbG9yXCIpLnNwZWN0cnVtKFwiaGlkZVwiKTtcbiAgICAgICAgJChcIi5iYWNrZ3JvdW5kLWNvbG9yXCIpLnNwZWN0cnVtKFwiaGlkZVwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgIFwic3R5bGVzaGVldHNcIjogXCI9XCIsXG4gICAgICAgICAgXCJiYWNrZ3JvdW5kXCI6IFwiPVwiLFxuICAgICAgICAgIFwiZGF0YVwiOiBcIj1cIlxuICAgICAgICB9LFxuICAgICAgICBsaW5rOiBsaW5rXG4gICAgICB9O1xuICAgIH0pO1xufSgpKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==