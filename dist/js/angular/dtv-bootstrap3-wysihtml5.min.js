!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,e){var l,r,d,c,s;$(e).wysihtml5({stylesheets:t.stylesheets}),n=$(".font-picker"),a=$(".background-color"),i=$("#editable").data("wysihtml5").editor,i.on("load",function(){o(t),$.each($(t.data).find("span").andSelf(),function(){d=$(this).attr("data-standard-font"),c=$(this).attr("data-google-font"),s=$(this).attr("data-custom-font"),l=$(this).attr("data-text-color"),r=$(this).attr("data-highlight-color"),d&&i.composer.commands.exec("standardFont",d,$(this).attr("data-standard-font-family")),c&&(n.data("plugin_fontPicker").addGoogleFont(c,!1),i.composer.commands.exec("googleFont",c)),s&&(RiseVision.Common.Utilities.loadCustomFont(s,$(this).attr("data-custom-font-url"),i.composer.iframe.contentDocument),i.composer.commands.exec("customFont",s,$(this).attr("data-custom-font-url"))),l&&i.composer.commands.exec("textColor",l),r&&i.composer.commands.exec("highlightColor",r)})})}function o(t){var o,l,r,d,c=null,s=null,u=!1,m=!1,g=!1,h="",p="",f="",y="",b="",w=null,k="",S=null;o=$(".emphasis"),l=$(".font-size-picker"),r=$(".text-color"),d=$(".highlight-color"),t.$on("collectAdditionalParams",function(){t.$parent.setAdditionalParam("data",i.getValue()),t.$parent.setAdditionalParam("background",i.composer.doc.body.getAttribute("data-background-color"))}),t.$on("loadAdditionalParams",function(t,o){i.setValue(o.data),o.background&&(w=tinycolor(o.background),k=w.toHexString(),S=w.toRgb(),a.spectrum("set",w),i.composer.commands.exec("backgroundColor",k,S,[{name:"data-background-color",value:w.toRgbString()}]))}),$(".font-picker").on("show.bfhselectbox",function(){e()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){e()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){e()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){e(),c=i.composer.selection.getSelectedNode(),c&&3===c.nodeType&&(s=c.parentNode,s&&1===s.nodeType&&("body"!==s.tagName.toLowerCase()?(u="bold"===window.getComputedStyle(s,null).getPropertyValue("font-weight")?!0:!1,m="italic"===window.getComputedStyle(s,null).getPropertyValue("font-style")?!0:!1,g=-1!==window.getComputedStyle(s,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,o.data("plugin_fontStyle").setStyles({bold:u,italic:m,underline:g}),h=window.getComputedStyle(s,null).getPropertyValue("font-family"),h&&n.data("plugin_fontPicker").setFont(h),p=window.getComputedStyle(s,null).getPropertyValue("font-size"),p&&l.data("plugin_fontSizePicker").setFontSize(p),f=$(s).data("line-height")?$(s).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",f),y=window.getComputedStyle(s,null).getPropertyValue("color"),b=window.getComputedStyle(s,null).getPropertyValue("background-color"),y&&r.spectrum("set",y),b&&d.spectrum("set",b)):(o.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function e(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var n,a,i=null;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJ0ZXh0Q29sb3IiLCJoaWdobGlnaHRDb2xvciIsInN0YW5kYXJkRm9udCIsImdvb2dsZUZvbnQiLCJjdXN0b21Gb250IiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiZWRpdG9yIiwiZGF0YSIsIm9uIiwiYmluZCIsImVhY2giLCJmaW5kIiwiYW5kU2VsZiIsInRoaXMiLCJhdHRyIiwiY29tcG9zZXIiLCJjb21tYW5kcyIsImV4ZWMiLCJhZGRHb29nbGVGb250IiwiUmlzZVZpc2lvbiIsIkNvbW1vbiIsIlV0aWxpdGllcyIsImxvYWRDdXN0b21Gb250IiwiaWZyYW1lIiwiY29udGVudERvY3VtZW50IiwiJGZvbnRTdHlsZSIsIiRmb250U2l6ZVBpY2tlciIsIiR0ZXh0Q29sb3IiLCIkaGlnaGxpZ2h0Q29sb3IiLCJub2RlIiwicGFyZW50Tm9kZSIsImlzQm9sZCIsImlzSXRhbGljIiwiaXNVbmRlcmxpbmUiLCJmb250IiwiZm9udFNpemUiLCJsaW5lSGVpZ2h0IiwiY29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoZXhTdHJpbmciLCJyZ2IiLCIkb24iLCIkcGFyZW50Iiwic2V0QWRkaXRpb25hbFBhcmFtIiwiZ2V0VmFsdWUiLCJkb2MiLCJib2R5IiwiZ2V0QXR0cmlidXRlIiwiZSIsImFkZGl0aW9uYWxQYXJhbXMiLCJzZXRWYWx1ZSIsImJhY2tncm91bmQiLCJ0aW55Y29sb3IiLCJ0b0hleFN0cmluZyIsInRvUmdiIiwic3BlY3RydW0iLCJuYW1lIiwidmFsdWUiLCJ0b1JnYlN0cmluZyIsImNsb3NlRHJvcGRvd25zIiwiY29udGVudHMiLCJzZWxlY3Rpb24iLCJnZXRTZWxlY3RlZE5vZGUiLCJub2RlVHlwZSIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiaW5kZXhPZiIsInNldFN0eWxlcyIsImJvbGQiLCJpdGFsaWMiLCJ1bmRlcmxpbmUiLCJzZXRGb250Iiwic2V0Rm9udFNpemUiLCJyZW1vdmVDbGFzcyIsInJlc3RyaWN0Iiwic2NvcGUiXSwibWFwcGluZ3MiOiJDQUVDLFdBQ0MsWUFFQUEsU0FBUUMsT0FBTyx5Q0FDWkMsVUFBVSxZQUFhLFdBSXRCLFFBQVNDLEdBQUtDLEVBQVFDLEdBQ3BCLEdBQUlDLEdBQVdDLEVBQ1hDLEVBQWNDLEVBQVlDLENBRTlCQyxHQUFFTixHQUFTTyxXQUNUQyxZQUFlVCxFQUFPUyxjQUd4QkMsRUFBY0gsRUFBRSxnQkFDaEJJLEVBQW1CSixFQUFFLHFCQUNyQkssRUFBU0wsRUFBRSxhQUFhTSxLQUFLLGFBQWFELE9BRTFDQSxFQUFPRSxHQUFHLE9BQVEsV0FDaEJDLEVBQUtmLEdBRUxPLEVBQUVTLEtBQUtULEVBQUVQLEVBQU9hLE1BQU1JLEtBQUssUUFBUUMsVUFBVyxXQUM1Q2QsRUFBZUcsRUFBRVksTUFBTUMsS0FBSyxzQkFDNUJmLEVBQWFFLEVBQUVZLE1BQU1DLEtBQUssb0JBQzFCZCxFQUFhQyxFQUFFWSxNQUFNQyxLQUFLLG9CQUMxQmxCLEVBQVlLLEVBQUVZLE1BQU1DLEtBQUssbUJBQ3pCakIsRUFBaUJJLEVBQUVZLE1BQU1DLEtBQUssd0JBRzFCaEIsR0FDRlEsRUFBT1MsU0FBU0MsU0FBU0MsS0FBSyxlQUFnQm5CLEVBQzVDRyxFQUFFWSxNQUFNQyxLQUFLLDhCQUliZixJQUNGSyxFQUFZRyxLQUFLLHFCQUNkVyxjQUFjbkIsR0FBWSxHQUk3Qk8sRUFBT1MsU0FBU0MsU0FBU0MsS0FBSyxhQUFjbEIsSUFJMUNDLElBQ0ZtQixXQUFXQyxPQUFPQyxVQUFVQyxlQUFldEIsRUFDekNDLEVBQUVZLE1BQU1DLEtBQUssd0JBQ2JSLEVBQU9TLFNBQVNRLE9BQU9DLGlCQUN6QmxCLEVB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LEdBQ0ZWLEVBQVc0QixTQUFTLE1BQU9sQixHQUd6QnhDLEdBQ0YrQixFQUFnQjJCLFNBQVMsTUFBTzFELEtBS2xDNEIsRUFBV2xCLEtBQUssb0JBQW9CK0QsV0FDbENDLE1BQVEsRUFDUkMsUUFBVSxFQUNWQyxXQUFhLElBSWZ4RSxFQUFFLHVCQUF1Qk0sS0FBSywwQkFBMkIsUUFRbkUsUUFBU29ELEtBQ1AxRCxFQUFFLCtHQUVDMkUsWUFBWSxRQUNmM0UsRUFBRSxlQUFlc0QsU0FBUyxRQUMxQnRELEVBQUUsb0JBQW9Cc0QsU0FBUyxRQUMvQnRELEVBQUUscUJBQXFCc0QsU0FBUyxRQTVNbEMsR0FDSW5ELEdBQWFDLEVBRGJDLEVBQVMsSUErTWIsUUFDRXVFLFNBQVUsSUFDVkMsT0FDRTNFLFlBQWUsSUFDZmdELFdBQWMsSUFDZDVDLEtBQVEsS0FFVmQsS0FBTUEiLCJmaWxlIjoiZHR2LWJvb3RzdHJhcDMtd3lzaWh0bWw1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBhbmd1bGFyLCB0aW55Y29sb3IsICQgKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24ud3lzaWh0bWw1XCIsIFtdKVxuICAgIC5kaXJlY3RpdmUoXCJ3eXNpaHRtbDVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVkaXRvciA9IG51bGw7XG4gICAgICB2YXIgJGZvbnRQaWNrZXIsICRiYWNrZ3JvdW5kQ29sb3I7XG5cbiAgICAgIGZ1bmN0aW9uIGxpbmsoJHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgIHZhciB0ZXh0Q29sb3IsIGhpZ2hsaWdodENvbG9yO1xuICAgICAgICB2YXIgc3RhbmRhcmRGb250LCBnb29nbGVGb250LCBjdXN0b21Gb250O1xuXG4gICAgICAgICQoZWxlbWVudCkud3lzaWh0bWw1KHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6ICRzY29wZS5zdHlsZXNoZWV0c1xuICAgICAgICB9KTtcblxuICAgICAgICAkZm9udFBpY2tlciA9ICQoXCIuZm9udC1waWNrZXJcIik7XG4gICAgICAgICRiYWNrZ3JvdW5kQ29sb3IgPSAkKFwiLmJhY2tncm91bmQtY29sb3JcIik7XG4gICAgICAgIGVkaXRvciA9ICQoXCIjZWRpdGFibGVcIikuZGF0YShcInd5c2lodG1sNVwiKS5lZGl0b3I7XG5cbiAgICAgICAgZWRpdG9yLm9uKFwibG9hZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBiaW5kKCRzY29wZSk7XG5cbiAgICAgICAgICAkLmVhY2goJCgkc2NvcGUuZGF0YSkuZmluZChcInNwYW5cIikuYW5kU2VsZigpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHN0YW5kYXJkRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udFwiKTtcbiAgICAgICAgICAgIGdvb2dsZUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWdvb2dsZS1mb250XCIpO1xuICAgICAgICAgICAgY3VzdG9tRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnRcIik7XG4gICAgICAgICAgICB0ZXh0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXRleHQtY29sb3JcIik7XG4gICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9ICQodGhpcykuYXR0cihcImRhdGEtaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBzdGFuZGFyZCBmb250cy5cbiAgICAgICAgICAgIGlmIChzdGFuZGFyZEZvbnQpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJzdGFuZGFyZEZvbnRcIiwgc3RhbmRhcmRGb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udC1mYW1pbHlcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBHb29nbGUgZm9udHMuXG4gICAgICAgICAgICBpZiAoZ29vZ2xlRm9udCkge1xuICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAuYWRkR29vZ2xlRm9udChnb29nbGVGb250LCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgLy8gVGhpcyB3b24ndCBhZGQgYSBuZXcgc3BhbiB0YWcgYmVjYXVzZSBhIHJhbmdlIHdpbGwgbm90IGhhdmVcbiAgICAgICAgICAgICAgLy8gYmVlbiBzZWxlY3RlZCwgd2hpY2ggaXMgd2hhdCB3ZSB3YW50LlxuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImdvb2dsZUZvbnRcIiwgZ29vZ2xlRm9udCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYWQgYW5kIGFkZCBDU1MgZm9yIGN1c3RvbSBmb250cy5cbiAgICAgICAgICAgIGlmIChjdXN0b21Gb250KSB7XG4gICAgICAgICAgICAgIFJpc2VWaXNpb24uQ29tbW9uLlV0aWxpdGllcy5sb2FkQ3VzdG9tRm9udChjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpLFxuICAgICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5pZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJjdXN0b21Gb250XCIsIGN1c3RvbUZvbnQsXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1jdXN0b20tZm9udC11cmxcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBjb2xvcnMuXG4gICAgICAgICAgICBpZiAodGV4dENvbG9yKSB7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwidGV4dENvbG9yXCIsIHRleHRDb2xvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImhpZ2hsaWdodENvbG9yXCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGJpbmQoJHNjb3BlKSB7XG4gICAgICAgIHZhciBub2RlID0gbnVsbCwgcGFyZW50Tm9kZSA9IG51bGw7XG4gICAgICAgIHZhciBpc0JvbGQgPSBmYWxzZSwgaXNJdGFsaWMgPSBmYWxzZSwgaXNVbmRlcmxpbmUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZvbnQgPSBcIlwiLCBmb250U2l6ZSA9IFwiXCIsIGxpbmVIZWlnaHQgPSBcIlwiO1xuICAgICAgICB2YXIgY29sb3IgPSBcIlwiLCBoaWdobGlnaHRDb2xvciA9IFwiXCIsIGJhY2tncm91bmRDb2xvciA9IG51bGw7XG4gICAgICAgIHZhciBoZXhTdHJpbmcgPSBcIlwiLCByZ2IgPSBudWxsO1xuICAgICAgICB2YXIgJGZvbnRTdHlsZSwgJGZvbnRTaXplUGlja2VyO1xuICAgICAgICB2YXIgJHRleHRDb2xvciwgJGhpZ2hsaWdodENvbG9yO1xuXG4gICAgICAgICRmb250U3R5bGUgPSAkKFwiLmVtcGhhc2lzXCIpO1xuICAgICAgICAkZm9udFNpemVQaWNrZXIgPSAkKFwiLmZvbnQtc2l6ZS1waWNrZXJcIik7XG4gICAgICAgICR0ZXh0Q29sb3IgPSAkKFwiLnRleHQtY29sb3JcIik7XG4gICAgICAgICRoaWdobGlnaHRDb2xvciA9ICQoXCIuaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBoYW5kbGVycy5cbiAgICAgICAgJHNjb3BlLiRvbihcImNvbGxlY3RBZGRpdGlvbmFsUGFyYW1zXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImRhdGFcIiwgZWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImJhY2tncm91bmRcIiwgZWRpdG9yLmNvbXBvc2VyLmRvYy5ib2R5LmdldEF0dHJpYnV0ZShcImRhdGEtYmFja2dyb3VuZC1jb2xvclwiKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kb24oXCJsb2FkQWRkaXRpb25hbFBhcmFtc1wiLCBmdW5jdGlvbiAoZSwgYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShhZGRpdGlvbmFsUGFyYW1zLmRhdGEpO1xuXG4gICAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgY29sb3IuXG4gICAgICAgICAgaWYgKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gdGlueWNvbG9yKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCk7XG4gICAgICAgICAgICBoZXhTdHJpbmcgPSBiYWNrZ3JvdW5kQ29sb3IudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIHJnYiA9IGJhY2tncm91bmRDb2xvci50b1JnYigpO1xuXG4gICAgICAgICAgICAkYmFja2dyb3VuZENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImJhY2tncm91bmRDb2xvclwiLCBoZXhTdHJpbmcsIHJnYiwgW3tcbiAgICAgICAgICAgICAgbmFtZTogXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIixcbiAgICAgICAgICAgICAgdmFsdWU6IGJhY2tncm91bmRDb2xvci50b1JnYlN0cmluZygpXG4gICAgICAgICAgICB9XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiLmZvbnQtcGlja2VyXCIpLm9uKFwic2hvdy5iZmhzZWxlY3Rib3hcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChcIi5mb250LXNpemUtcGlja2VyLCAubGluZS1oZWlnaHQsIC5hbGlnbm1lbnRcIikub24oXCJzaG93LmJzLmRyb3Bkb3duXCIsXG4gICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAkKFwiLnRleHQtY29sb3IsIC5oaWdobGlnaHQtY29sb3IsIC5iYWNrZ3JvdW5kLWNvbG9yXCIpXG4gICAgICAgICAgLm9uKFwiYmVmb3JlU2hvd1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFdoZW4gdGhlIHVzZXIgY2xpY2tzIGluIHRoZSBlZGl0b3IsIHNldCB0b29sYmFyIHRvIG1hdGNoIHRleHQgc3R5bGVzLlxuICAgICAgICAkKFwiLnd5c2lodG1sNS1zYW5kYm94XCIpLmNvbnRlbnRzKCkuZmluZChcImJvZHlcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuXG4gICAgICAgICAgbm9kZSA9IGVkaXRvci5jb21wb3Nlci5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWROb2RlKCk7XG5cbiAgICAgICAgICAvLyBUaGUgc2VsZWN0ZWQgbm9kZSBpcyBhIHRleHQgbm9kZS5cbiAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgICBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICAvLyBUaGUgcGFyZW50IG5vZGUgaXMgYW4gZWxlbWVudC5cbiAgICAgICAgICAgIGlmIChwYXJlbnROb2RlICYmIHBhcmVudE5vZGUubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIG5vdCB0aGUgZWRpdG9yIGVsZW1lbnQgaXRzZWxmLlxuICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09IFwiYm9keVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9udCBTdHlsZVxuICAgICAgICAgICAgICAgIGlzQm9sZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtd2VpZ2h0XCIpID09PSBcImJvbGRcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0l0YWxpYyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc3R5bGVcIikgPT09IFwiaXRhbGljXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNVbmRlcmxpbmUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJ0ZXh0LWRlY29yYXRpb25cIikuaW5kZXhPZihcInVuZGVybGluZVwiKSAhPT0gLTEgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAkZm9udFN0eWxlLmRhdGEoXCJwbHVnaW5fZm9udFN0eWxlXCIpLnNldFN0eWxlcyh7XG4gICAgICAgICAgICAgICAgICBcImJvbGRcIjogaXNCb2xkLFxuICAgICAgICAgICAgICAgICAgXCJpdGFsaWNcIjogaXNJdGFsaWMsXG4gICAgICAgICAgICAgICAgICBcInVuZGVybGluZVwiOiBpc1VuZGVybGluZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gRm9udFxuICAgICAgICAgICAgICAgIGZvbnQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LWZhbWlseVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250KSB7XG4gICAgICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIikuc2V0Rm9udChmb250KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBGb250IHNpemVcbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc2l6ZVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRTaXplUGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFNpemVQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEZvbnRTaXplKGZvbnRTaXplKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBMaW5lIEhlaWdodFxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSAkKHBhcmVudE5vZGUpLmRhdGEoXCJsaW5lLWhlaWdodFwiKSA/XG4gICAgICAgICAgICAgICAgICAkKHBhcmVudE5vZGUpLmRhdGEoXCJsaW5lLWhlaWdodFwiKSA6IDE7XG5cbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGJ1dHRvblwiKS5kYXRhKFwid3lzaWh0bWw1LWNvbW1hbmQtdmFsdWVcIixcbiAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29sb3JzXG4gICAgICAgICAgICAgICAgY29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJjb2xvclwiKTtcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImJhY2tncm91bmQtY29sb3JcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgY29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICAgICAgJGhpZ2hsaWdodENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgZm9udCBzdHlsZS5cbiAgICAgICAgICAgICAgICAkZm9udFN0eWxlLmRhdGEoXCJwbHVnaW5fZm9udFN0eWxlXCIpLnNldFN0eWxlcyh7XG4gICAgICAgICAgICAgICAgICBcImJvbGRcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBcIml0YWxpY1wiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIFwidW5kZXJsaW5lXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBSZXNldCBsaW5lIGhlaWdodC5cbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGJ1dHRvblwiKS5kYXRhKFwid3lzaWh0bWw1LWNvbW1hbmQtdmFsdWVcIiwgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDbG9zZSBhbGwgb3BlbiBkcm9wZG93bnMuXG4gICAgICBmdW5jdGlvbiBjbG9zZURyb3Bkb3ducygpIHtcbiAgICAgICAgJChcIi5vcGVuLmFsaWdubWVudCwgLmZvbnQtcGlja2VyIC5vcGVuLmJmaC1zZWxlY3Rib3gsIFwiICtcbiAgICAgICAgICBcIi5mb250LXNpemUtcGlja2VyIC5vcGVuLmJmaC1mb250c2l6ZXMsIC5vcGVuLmxpbmUtaGVpZ2h0XCIpXG4gICAgICAgICAgLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgJChcIi50ZXh0LWNvbG9yXCIpLnNwZWN0cnVtKFwiaGlkZVwiKTtcbiAgICAgICAgJChcIi5oaWdobGlnaHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmJhY2tncm91bmQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBXCIsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgXCJzdHlsZXNoZWV0c1wiOiBcIj1cIixcbiAgICAgICAgICBcImJhY2tncm91bmRcIjogXCI9XCIsXG4gICAgICAgICAgXCJkYXRhXCI6IFwiPVwiXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGxpbmtcbiAgICAgIH07XG4gICAgfSk7XG59KCkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9