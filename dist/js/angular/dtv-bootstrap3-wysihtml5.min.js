!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,o){var a,r,c,d,s,u,m,g;$(o).wysihtml5({stylesheets:t.stylesheets}),n=$(".font-picker"),i=$(".background-color"),l=$("#editable").data("wysihtml5").editor,l.on("load",function(){e(),l.setValue(t.data),t.background&&(c=tinycolor(t.background),a=c.toHexString(),r=c.toRgb(),i.spectrum("set",c),l.composer.commands.exec("backgroundColor",a,r,[{name:"data-background-color",value:c.toRgbString()}])),$.each($(t.data).find("span").andSelf(),function(){u=$(this).attr("data-standard-font"),m=$(this).attr("data-google-font"),g=$(this).attr("data-custom-font"),d=$(this).attr("data-text-color"),s=$(this).attr("data-highlight-color"),u&&l.composer.commands.exec("standardFont",u,$(this).attr("data-standard-font-family")),m&&(n.data("plugin_fontPicker").addGoogleFont(m,!1),l.composer.commands.exec("googleFont",m)),g&&(RiseVision.Common.Utilities.loadCustomFont(g,$(this).attr("data-custom-font-url"),l.composer.iframe.contentDocument),l.composer.commands.exec("customFont",g,$(this).attr("data-custom-font-url"))),d&&l.composer.commands.exec("textColor",d),s&&l.composer.commands.exec("highlightColor",s)})})}function e(){var t,e,i,a,r=null,c=null,d=!1,s=!1,u=!1,m="",g="",h="",p="",f="";t=$(".emphasis"),e=$(".font-size-picker"),i=$(".text-color"),a=$(".highlight-color"),$(".font-picker").on("show.bfhselectbox",function(){o()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){o()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){o()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){o(),r=l.composer.selection.getSelectedNode(),r&&3===r.nodeType&&(c=r.parentNode,c&&1===c.nodeType&&("body"!==c.tagName.toLowerCase()?(d="bold"===window.getComputedStyle(c,null).getPropertyValue("font-weight")?!0:!1,s="italic"===window.getComputedStyle(c,null).getPropertyValue("font-style")?!0:!1,u=-1!==window.getComputedStyle(c,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,t.data("plugin_fontStyle").setStyles({bold:d,italic:s,underline:u}),m=window.getComputedStyle(c,null).getPropertyValue("font-family"),m&&n.data("plugin_fontPicker").setFont(m),g=window.getComputedStyle(c,null).getPropertyValue("font-size"),g&&e.data("plugin_fontSizePicker").setFontSize(g),h=$(c).data("line-height")?$(c).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",h),p=window.getComputedStyle(c,null).getPropertyValue("color"),f=window.getComputedStyle(c,null).getPropertyValue("background-color"),p&&i.spectrum("set",p),f&&a.spectrum("set",f)):(t.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function o(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var n,i,l=null;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();