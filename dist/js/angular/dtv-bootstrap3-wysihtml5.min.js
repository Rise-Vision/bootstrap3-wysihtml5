!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,e){var l,r,d,c,s;$(e).wysihtml5({stylesheets:t.stylesheets}),n=$(".font-picker"),a=$(".background-color"),i=$("#editable").data("wysihtml5").editor,i.on("load",function(){o(t),$.each($(t.data).find("span").andSelf(),function(){d=$(this).attr("data-standard-font"),c=$(this).attr("data-google-font"),s=$(this).attr("data-custom-font"),l=$(this).attr("data-text-color"),r=$(this).attr("data-highlight-color"),d&&i.composer.commands.exec("standardFont",d,$(this).attr("data-standard-font-family")),c&&(n.data("plugin_fontPicker").addGoogleFont(c,!1),i.composer.commands.exec("googleFont",c)),s&&(RiseVision.Common.Utilities.loadCustomFont(s,$(this).attr("data-custom-font-url"),i.composer.iframe.contentDocument),i.composer.commands.exec("customFont",s,$(this).attr("data-custom-font-url"))),l&&i.composer.commands.exec("textColor",l),r&&i.composer.commands.exec("highlightColor",r)})})}function o(t){var o,l,r,d,c=null,s=null,u=!1,m=!1,g=!1,h="",p="",f="",y="",b="",w=null,k="",S=null;o=$(".emphasis"),l=$(".font-size-picker"),r=$(".text-color"),d=$(".highlight-color"),t.$on("collectAdditionalParams",function(){var o=i.composer.doc.body.getAttribute("data-background-color");t.$parent.setAdditionalParam("data",i.getValue()),t.$parent.setAdditionalParam("background",o?o:"")}),t.$on("loadAdditionalParams",function(t,o){i.setValue(o.data),o.background&&(w=tinycolor(o.background),k=w.toHexString(),S=w.toRgb(),a.spectrum("set",w),i.composer.commands.exec("backgroundColor",k,S,[{name:"data-background-color",value:w.toRgbString()}]))}),$(".font-picker").on("show.bfhselectbox",function(){e()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){e()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){e()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){e(),c=i.composer.selection.getSelectedNode(),c&&3===c.nodeType&&(s=c.parentNode,s&&1===s.nodeType&&("body"!==s.tagName.toLowerCase()?(u="bold"===window.getComputedStyle(s,null).getPropertyValue("font-weight")?!0:!1,m="italic"===window.getComputedStyle(s,null).getPropertyValue("font-style")?!0:!1,g=-1!==window.getComputedStyle(s,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,o.data("plugin_fontStyle").setStyles({bold:u,italic:m,underline:g}),h=window.getComputedStyle(s,null).getPropertyValue("font-family"),h&&n.data("plugin_fontPicker").setFont(h),p=window.getComputedStyle(s,null).getPropertyValue("font-size"),p&&l.data("plugin_fontSizePicker").setFontSize(p),f=$(s).data("line-height")?$(s).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",f),y=window.getComputedStyle(s,null).getPropertyValue("color"),b=window.getComputedStyle(s,null).getPropertyValue("background-color"),y&&r.spectrum("set",y),b&&d.spectrum("set",b)):(o.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function e(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var n,a,i=null;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJ0ZXh0Q29sb3IiLCJoaWdobGlnaHRDb2xvciIsInN0YW5kYXJkRm9udCIsImdvb2dsZUZvbnQiLCJjdXN0b21Gb250IiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiZWRpdG9yIiwiZGF0YSIsIm9uIiwiYmluZCIsImVhY2giLCJmaW5kIiwiYW5kU2VsZiIsInRoaXMiLCJhdHRyIiwiY29tcG9zZXIiLCJjb21tYW5kcyIsImV4ZWMiLCJhZGRHb29nbGVGb250IiwiUmlzZVZpc2lvbiIsIkNvbW1vbiIsIlV0aWxpdGllcyIsImxvYWRDdXN0b21Gb250IiwiaWZyYW1lIiwiY29udGVudERvY3VtZW50IiwiJGZvbnRTdHlsZSIsIiRmb250U2l6ZVBpY2tlciIsIiR0ZXh0Q29sb3IiLCIkaGlnaGxpZ2h0Q29sb3IiLCJub2RlIiwicGFyZW50Tm9kZSIsImlzQm9sZCIsImlzSXRhbGljIiwiaXNVbmRlcmxpbmUiLCJmb250IiwiZm9udFNpemUiLCJsaW5lSGVpZ2h0IiwiY29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoZXhTdHJpbmciLCJyZ2IiLCIkb24iLCJkb2MiLCJib2R5IiwiZ2V0QXR0cmlidXRlIiwiJHBhcmVudCIsInNldEFkZGl0aW9uYWxQYXJhbSIsImdldFZhbHVlIiwiZSIsImFkZGl0aW9uYWxQYXJhbXMiLCJzZXRWYWx1ZSIsImJhY2tncm91bmQiLCJ0aW55Y29sb3IiLCJ0b0hleFN0cmluZyIsInRvUmdiIiwic3BlY3RydW0iLCJuYW1lIiwidmFsdWUiLCJ0b1JnYlN0cmluZyIsImNsb3NlRHJvcGRvd25zIiwiY29udGVudHMiLCJzZWxlY3Rpb24iLCJnZXRTZWxlY3RlZE5vZGUiLCJub2RlVHlwZSIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiaW5kZXhPZiIsInNldFN0eWxlcyIsImJvbGQiLCJpdGFsaWMiLCJ1bmRlcmxpbmUiLCJzZXRGb250Iiwic2V0Rm9udFNpemUiLCJyZW1vdmVDbGFzcyIsInJlc3RyaWN0Iiwic2NvcGUiXSwibWFwcGluZ3MiOiJDQUVDLFdBQ0MsWUFFQUEsU0FBUUMsT0FBTyx5Q0FDWkMsVUFBVSxZQUFhLFdBSXRCLFFBQVNDLEdBQUtDLEVBQVFDLEdBQ3BCLEdBQUlDLEdBQVdDLEVBQ1hDLEVBQWNDLEVBQVlDLENBRTlCQyxHQUFFTixHQUFTTyxXQUNUQyxZQUFlVCxFQUFPUyxjQUd4QkMsRUFBY0gsRUFBRSxnQkFDaEJJLEVBQW1CSixFQUFFLHFCQUNyQkssRUFBU0wsRUFBRSxhQUFhTSxLQUFLLGFBQWFELE9BRTFDQSxFQUFPRSxHQUFHLE9BQVEsV0FDaEJDLEVBQUtmLEdBRUxPLEVBQUVTLEtBQUtULEVBQUVQLEVBQU9hLE1BQU1JLEtBQUssUUFBUUMsVUFBVyxXQUM1Q2QsRUFBZUcsRUFBRVksTUFBTUMsS0FBSyxzQkFDNUJmLEVBQWFFLEVBQUVZLE1BQU1DLEtBQUssb0JBQzFCZCxFQUFhQyxFQUFFWSxNQUFNQyxLQUFLLG9CQUMxQmxCLEVBQVlLLEVBQUVZLE1BQU1DLEtBQUssbUJBQ3pCakIsRUFBaUJJLEVBQUVZLE1BQU1DLEtBQUssd0JBRzFCaEIsR0FDRlEsRUFBT1MsU0FBU0MsU0FBU0MsS0FBSyxlQUFnQm5CLEVBQzVDRyxFQUFFWSxNQUFNQyxLQUFLLDhCQUliZixJQUNGSyxFQUFZRyxLQUFLLHFCQUNkVyxjQUFjbkIsR0FBWSxHQUk3Qk8sRUFBT1MsU0FBU0MsU0FBU0MsS0FBSyxhQUFjbEIsSUFJMUNDLElBQ0ZtQixXQUFXQyxPQUFPQyxVQUFVQyxlQUFldEIsRUFDekNDLEVBQUVZLE1BQU1DLEtBQUssd0JBQ2JSLEVBQU9TLFNBQVNRLE9BQU9DLGlCQUN6QmxCLEVB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QWlCckMsRUFBWSxNQUNsRHNDLGlCQUFpQixvQkFFaEIvQixHQUNGVixFQUFXNEIsU0FBUyxNQUFPbEIsR0FHekJ4QyxHQUNGK0IsRUFBZ0IyQixTQUFTLE1BQU8xRCxLQUtsQzRCLEVBQVdsQixLQUFLLG9CQUFvQitELFdBQ2xDQyxNQUFRLEVBQ1JDLFFBQVUsRUFDVkMsV0FBYSxJQUlmeEUsRUFBRSx1QkFBdUJNLEtBQUssMEJBQTJCLFFBUW5FLFFBQVNvRCxLQUNQMUQsRUFBRSwrR0FFQzJFLFlBQVksUUFDZjNFLEVBQUUsZUFBZXNELFNBQVMsUUFDMUJ0RCxFQUFFLG9CQUFvQnNELFNBQVMsUUFDL0J0RCxFQUFFLHFCQUFxQnNELFNBQVMsUUFoTmxDLEdBQ0luRCxHQUFhQyxFQURiQyxFQUFTLElBbU5iLFFBQ0V1RSxTQUFVLElBQ1ZDLE9BQ0UzRSxZQUFlLElBQ2ZnRCxXQUFjLElBQ2Q1QyxLQUFRLEtBRVZkLEtBQU1BIiwiZmlsZSI6ImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgUmlzZVZpc2lvbiwgYW5ndWxhciwgdGlueWNvbG9yLCAkICovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi53aWRnZXQuY29tbW9uLnd5c2lodG1sNVwiLCBbXSlcbiAgICAuZGlyZWN0aXZlKFwid3lzaWh0bWw1XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlZGl0b3IgPSBudWxsO1xuICAgICAgdmFyICRmb250UGlja2VyLCAkYmFja2dyb3VuZENvbG9yO1xuXG4gICAgICBmdW5jdGlvbiBsaW5rKCRzY29wZSwgZWxlbWVudCkge1xuICAgICAgICB2YXIgdGV4dENvbG9yLCBoaWdobGlnaHRDb2xvcjtcbiAgICAgICAgdmFyIHN0YW5kYXJkRm9udCwgZ29vZ2xlRm9udCwgY3VzdG9tRm9udDtcblxuICAgICAgICAkKGVsZW1lbnQpLnd5c2lodG1sNSh7XG4gICAgICAgICAgXCJzdHlsZXNoZWV0c1wiOiAkc2NvcGUuc3R5bGVzaGVldHNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGZvbnRQaWNrZXIgPSAkKFwiLmZvbnQtcGlja2VyXCIpO1xuICAgICAgICAkYmFja2dyb3VuZENvbG9yID0gJChcIi5iYWNrZ3JvdW5kLWNvbG9yXCIpO1xuICAgICAgICBlZGl0b3IgPSAkKFwiI2VkaXRhYmxlXCIpLmRhdGEoXCJ3eXNpaHRtbDVcIikuZWRpdG9yO1xuXG4gICAgICAgIGVkaXRvci5vbihcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYmluZCgkc2NvcGUpO1xuXG4gICAgICAgICAgJC5lYWNoKCQoJHNjb3BlLmRhdGEpLmZpbmQoXCJzcGFuXCIpLmFuZFNlbGYoKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdGFuZGFyZEZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnRcIik7XG4gICAgICAgICAgICBnb29nbGVGb250ID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1nb29nbGUtZm9udFwiKTtcbiAgICAgICAgICAgIGN1c3RvbUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250XCIpO1xuICAgICAgICAgICAgdGV4dENvbG9yID0gJCh0aGlzKS5hdHRyKFwiZGF0YS10ZXh0LWNvbG9yXCIpO1xuICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWhpZ2hsaWdodC1jb2xvclwiKTtcblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3Igc3RhbmRhcmQgZm9udHMuXG4gICAgICAgICAgICBpZiAoc3RhbmRhcmRGb250KSB7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwic3RhbmRhcmRGb250XCIsIHN0YW5kYXJkRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnQtZmFtaWx5XCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hZCBhbmQgYWRkIENTUyBmb3IgR29vZ2xlIGZvbnRzLlxuICAgICAgICAgICAgaWYgKGdvb2dsZUZvbnQpIHtcbiAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpXG4gICAgICAgICAgICAgICAgLmFkZEdvb2dsZUZvbnQoZ29vZ2xlRm9udCwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgIC8vIFRoaXMgd29uJ3QgYWRkIGEgbmV3IHNwYW4gdGFnIGJlY2F1c2UgYSByYW5nZSB3aWxsIG5vdCBoYXZlXG4gICAgICAgICAgICAgIC8vIGJlZW4gc2VsZWN0ZWQsIHdoaWNoIGlzIHdoYXQgd2Ugd2FudC5cbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJnb29nbGVGb250XCIsIGdvb2dsZUZvbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBjdXN0b20gZm9udHMuXG4gICAgICAgICAgICBpZiAoY3VzdG9tRm9udCkge1xuICAgICAgICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5VdGlsaXRpZXMubG9hZEN1c3RvbUZvbnQoY3VzdG9tRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250LXVybFwiKSxcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuaWZyYW1lLmNvbnRlbnREb2N1bWVudCk7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiY3VzdG9tRm9udFwiLCBjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3IgY29sb3JzLlxuICAgICAgICAgICAgaWYgKHRleHRDb2xvcikge1xuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcInRleHRDb2xvclwiLCB0ZXh0Q29sb3IpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJoaWdobGlnaHRDb2xvclwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBiaW5kKCRzY29wZSkge1xuICAgICAgICB2YXIgbm9kZSA9IG51bGwsIHBhcmVudE5vZGUgPSBudWxsO1xuICAgICAgICB2YXIgaXNCb2xkID0gZmFsc2UsIGlzSXRhbGljID0gZmFsc2UsIGlzVW5kZXJsaW5lID0gZmFsc2U7XG4gICAgICAgIHZhciBmb250ID0gXCJcIiwgZm9udFNpemUgPSBcIlwiLCBsaW5lSGVpZ2h0ID0gXCJcIjtcbiAgICAgICAgdmFyIGNvbG9yID0gXCJcIiwgaGlnaGxpZ2h0Q29sb3IgPSBcIlwiLCBiYWNrZ3JvdW5kQ29sb3IgPSBudWxsO1xuICAgICAgICB2YXIgaGV4U3RyaW5nID0gXCJcIiwgcmdiID0gbnVsbDtcbiAgICAgICAgdmFyICRmb250U3R5bGUsICRmb250U2l6ZVBpY2tlcjtcbiAgICAgICAgdmFyICR0ZXh0Q29sb3IsICRoaWdobGlnaHRDb2xvcjtcblxuICAgICAgICAkZm9udFN0eWxlID0gJChcIi5lbXBoYXNpc1wiKTtcbiAgICAgICAgJGZvbnRTaXplUGlja2VyID0gJChcIi5mb250LXNpemUtcGlja2VyXCIpO1xuICAgICAgICAkdGV4dENvbG9yID0gJChcIi50ZXh0LWNvbG9yXCIpO1xuICAgICAgICAkaGlnaGxpZ2h0Q29sb3IgPSAkKFwiLmhpZ2hsaWdodC1jb2xvclwiKTtcblxuICAgICAgICAvLyBBZGQgZXZlbnQgaGFuZGxlcnMuXG4gICAgICAgICRzY29wZS4kb24oXCJjb2xsZWN0QWRkaXRpb25hbFBhcmFtc1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgYmFja2dyb3VuZENvbG9yID0gZWRpdG9yLmNvbXBvc2VyLmRvYy5ib2R5XG4gICAgICAgICAgICAuZ2V0QXR0cmlidXRlKFwiZGF0YS1iYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiZGF0YVwiLCBlZGl0b3IuZ2V0VmFsdWUoKSk7XG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiYmFja2dyb3VuZFwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID8gYmFja2dyb3VuZENvbG9yIDogXCJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kb24oXCJsb2FkQWRkaXRpb25hbFBhcmFtc1wiLCBmdW5jdGlvbiAoZSwgYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShhZGRpdGlvbmFsUGFyYW1zLmRhdGEpO1xuXG4gICAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgY29sb3IuXG4gICAgICAgICAgaWYgKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gdGlueWNvbG9yKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCk7XG4gICAgICAgICAgICBoZXhTdHJpbmcgPSBiYWNrZ3JvdW5kQ29sb3IudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIHJnYiA9IGJhY2tncm91bmRDb2xvci50b1JnYigpO1xuXG4gICAgICAgICAgICAkYmFja2dyb3VuZENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImJhY2tncm91bmRDb2xvclwiLCBoZXhTdHJpbmcsIHJnYiwgW3tcbiAgICAgICAgICAgICAgbmFtZTogXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIixcbiAgICAgICAgICAgICAgdmFsdWU6IGJhY2tncm91bmRDb2xvci50b1JnYlN0cmluZygpXG4gICAgICAgICAgICB9XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiLmZvbnQtcGlja2VyXCIpLm9uKFwic2hvdy5iZmhzZWxlY3Rib3hcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChcIi5mb250LXNpemUtcGlja2VyLCAubGluZS1oZWlnaHQsIC5hbGlnbm1lbnRcIikub24oXCJzaG93LmJzLmRyb3Bkb3duXCIsXG4gICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAkKFwiLnRleHQtY29sb3IsIC5oaWdobGlnaHQtY29sb3IsIC5iYWNrZ3JvdW5kLWNvbG9yXCIpXG4gICAgICAgICAgLm9uKFwiYmVmb3JlU2hvd1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFdoZW4gdGhlIHVzZXIgY2xpY2tzIGluIHRoZSBlZGl0b3IsIHNldCB0b29sYmFyIHRvIG1hdGNoIHRleHQgc3R5bGVzLlxuICAgICAgICAkKFwiLnd5c2lodG1sNS1zYW5kYm94XCIpLmNvbnRlbnRzKCkuZmluZChcImJvZHlcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuXG4gICAgICAgICAgbm9kZSA9IGVkaXRvci5jb21wb3Nlci5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWROb2RlKCk7XG5cbiAgICAgICAgICAvLyBUaGUgc2VsZWN0ZWQgbm9kZSBpcyBhIHRleHQgbm9kZS5cbiAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgICBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICAvLyBUaGUgcGFyZW50IG5vZGUgaXMgYW4gZWxlbWVudC5cbiAgICAgICAgICAgIGlmIChwYXJlbnROb2RlICYmIHBhcmVudE5vZGUubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIG5vdCB0aGUgZWRpdG9yIGVsZW1lbnQgaXRzZWxmLlxuICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09IFwiYm9keVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9udCBTdHlsZVxuICAgICAgICAgICAgICAgIGlzQm9sZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtd2VpZ2h0XCIpID09PSBcImJvbGRcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0l0YWxpYyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc3R5bGVcIikgPT09IFwiaXRhbGljXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNVbmRlcmxpbmUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJ0ZXh0LWRlY29yYXRpb25cIikuaW5kZXhPZihcInVuZGVybGluZVwiKSAhPT0gLTEgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAkZm9udFN0eWxlLmRhdGEoXCJwbHVnaW5fZm9udFN0eWxlXCIpLnNldFN0eWxlcyh7XG4gICAgICAgICAgICAgICAgICBcImJvbGRcIjogaXNCb2xkLFxuICAgICAgICAgICAgICAgICAgXCJpdGFsaWNcIjogaXNJdGFsaWMsXG4gICAgICAgICAgICAgICAgICBcInVuZGVybGluZVwiOiBpc1VuZGVybGluZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gRm9udFxuICAgICAgICAgICAgICAgIGZvbnQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LWZhbWlseVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250KSB7XG4gICAgICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIikuc2V0Rm9udChmb250KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBGb250IHNpemVcbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc2l6ZVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRTaXplUGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFNpemVQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEZvbnRTaXplKGZvbnRTaXplKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBMaW5lIEhlaWdodFxuICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQgPSAkKHBhcmVudE5vZGUpLmRhdGEoXCJsaW5lLWhlaWdodFwiKSA/XG4gICAgICAgICAgICAgICAgICAkKHBhcmVudE5vZGUpLmRhdGEoXCJsaW5lLWhlaWdodFwiKSA6IDE7XG5cbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGJ1dHRvblwiKS5kYXRhKFwid3lzaWh0bWw1LWNvbW1hbmQtdmFsdWVcIixcbiAgICAgICAgICAgICAgICAgIGxpbmVIZWlnaHQpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29sb3JzXG4gICAgICAgICAgICAgICAgY29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJjb2xvclwiKTtcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImJhY2tncm91bmQtY29sb3JcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgY29sb3IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICAgICAgJGhpZ2hsaWdodENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgZm9udCBzdHlsZS5cbiAgICAgICAgICAgICAgICAkZm9udFN0eWxlLmRhdGEoXCJwbHVnaW5fZm9udFN0eWxlXCIpLnNldFN0eWxlcyh7XG4gICAgICAgICAgICAgICAgICBcImJvbGRcIjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBcIml0YWxpY1wiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIFwidW5kZXJsaW5lXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBSZXNldCBsaW5lIGhlaWdodC5cbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGJ1dHRvblwiKS5kYXRhKFwid3lzaWh0bWw1LWNvbW1hbmQtdmFsdWVcIiwgMSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDbG9zZSBhbGwgb3BlbiBkcm9wZG93bnMuXG4gICAgICBmdW5jdGlvbiBjbG9zZURyb3Bkb3ducygpIHtcbiAgICAgICAgJChcIi5vcGVuLmFsaWdubWVudCwgLmZvbnQtcGlja2VyIC5vcGVuLmJmaC1zZWxlY3Rib3gsIFwiICtcbiAgICAgICAgICBcIi5mb250LXNpemUtcGlja2VyIC5vcGVuLmJmaC1mb250c2l6ZXMsIC5vcGVuLmxpbmUtaGVpZ2h0XCIpXG4gICAgICAgICAgLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgJChcIi50ZXh0LWNvbG9yXCIpLnNwZWN0cnVtKFwiaGlkZVwiKTtcbiAgICAgICAgJChcIi5oaWdobGlnaHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmJhY2tncm91bmQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBXCIsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgXCJzdHlsZXNoZWV0c1wiOiBcIj1cIixcbiAgICAgICAgICBcImJhY2tncm91bmRcIjogXCI9XCIsXG4gICAgICAgICAgXCJkYXRhXCI6IFwiPVwiXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGxpbmtcbiAgICAgIH07XG4gICAgfSk7XG59KCkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9