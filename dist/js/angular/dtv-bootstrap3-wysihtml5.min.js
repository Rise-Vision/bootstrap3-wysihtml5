!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,n){var s=null,u="",m=null;$(n).wysihtml5({stylesheets:t.stylesheets}),a=$(".font-picker"),i=$(".background-color"),r=$("#editable").data("wysihtml5").editor,t.$on("loadAdditionalParams",function(t,e){c=!0,l=e,r.setValue(e.data),e.background&&(s=tinycolor(e.background),u=s.toHexString(),m=s.toRgb(),i.spectrum("set",s),r.composer.commands.exec("backgroundColor",u,m,[{name:"data-background-color",value:s.toRgbString()}])),o()}),t.$on("collectAdditionalParams",function(){s=r.composer.doc.body.getAttribute("data-background-color"),t.$parent.setAdditionalParam("data",r.getValue()),t.$parent.setAdditionalParam("background",s?s:"")}),r.on("load",function(){d=!0,e(),o()})}function o(){var t,o,e,n,i;d&&c&&$.each($(l.data).find("span").addBack(),function(){e=$(this).attr("data-standard-font"),n=$(this).attr("data-google-font"),i=$(this).attr("data-custom-font"),t=$(this).attr("data-text-color"),o=$(this).attr("data-highlight-color"),e&&r.composer.commands.exec("standardFont",e,$(this).attr("data-standard-font-family")),n&&(a.data("plugin_fontPicker").addGoogleFont(n,!1),r.composer.commands.exec("googleFont",n)),i&&(RiseVision.Common.Utilities.loadCustomFont(i,$(this).attr("data-custom-font-url"),r.composer.iframe.contentDocument),r.composer.commands.exec("customFont",i,$(this).attr("data-custom-font-url"))),t&&r.composer.commands.exec("textColor",t),o&&r.composer.commands.exec("highlightColor",o)})}function e(){var t,o,e,i,l=null,d=null,c=!1,s=!1,u=!1,m="",g="",h="",p="",f="";t=$(".emphasis"),o=$(".font-size-picker"),e=$(".text-color"),i=$(".highlight-color"),$(".font-picker").on("show.bfhselectbox",function(){n()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){n()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){n()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){n(),l=r.composer.selection.getSelectedNode(),l&&3===l.nodeType&&(d=l.parentNode,d&&1===d.nodeType&&("body"!==d.tagName.toLowerCase()?(c="bold"===window.getComputedStyle(d,null).getPropertyValue("font-weight")?!0:!1,s="italic"===window.getComputedStyle(d,null).getPropertyValue("font-style")?!0:!1,u=-1!==window.getComputedStyle(d,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,t.data("plugin_fontStyle").setStyles({bold:c,italic:s,underline:u}),m=window.getComputedStyle(d,null).getPropertyValue("font-family"),m&&a.data("plugin_fontPicker").setFont(m),g=window.getComputedStyle(d,null).getPropertyValue("font-size"),g&&o.data("plugin_fontSizePicker").setFontSize(g),h=$(d).data("line-height")?$(d).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",h),p=window.getComputedStyle(d,null).getPropertyValue("color"),f=window.getComputedStyle(d,null).getPropertyValue("background-color"),p&&e.spectrum("set",p),f&&i.spectrum("set",f)):(t.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function n(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var a,i,l,r=null,d=!1,c=!1;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJoZXhTdHJpbmciLCJyZ2IiLCIkIiwid3lzaWh0bWw1Iiwic3R5bGVzaGVldHMiLCIkZm9udFBpY2tlciIsIiRiYWNrZ3JvdW5kQ29sb3IiLCJlZGl0b3IiLCJkYXRhIiwiJG9uIiwiZSIsImFkZGl0aW9uYWxQYXJhbXMiLCJpc1BhcmFtc0xvYWRlZCIsInBhcmFtcyIsInNldFZhbHVlIiwiYmFja2dyb3VuZCIsInRpbnljb2xvciIsInRvSGV4U3RyaW5nIiwidG9SZ2IiLCJzcGVjdHJ1bSIsImNvbXBvc2VyIiwiY29tbWFuZHMiLCJleGVjIiwibmFtZSIsInZhbHVlIiwidG9SZ2JTdHJpbmciLCJpbml0RWRpdG9yIiwiZG9jIiwiYm9keSIsImdldEF0dHJpYnV0ZSIsIiRwYXJlbnQiLCJzZXRBZGRpdGlvbmFsUGFyYW0iLCJnZXRWYWx1ZSIsIm9uIiwiaXNFZGl0b3JMb2FkZWQiLCJiaW5kIiwidGV4dENvbG9yIiwiaGlnaGxpZ2h0Q29sb3IiLCJzdGFuZGFyZEZvbnQiLCJnb29nbGVGb250IiwiY3VzdG9tRm9udCIsImVhY2giLCJmaW5kIiwiYWRkQmFjayIsInRoaXMiLCJhdHRyIiwiYWRkR29vZ2xlRm9udCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJVdGlsaXRpZXMiLCJsb2FkQ3VzdG9tRm9udCIsImlmcmFtZSIsImNvbnRlbnREb2N1bWVudCIsIiRmb250U3R5bGUiLCIkZm9udFNpemVQaWNrZXIiLCIkdGV4dENvbG9yIiwiJGhpZ2hsaWdodENvbG9yIiwibm9kZSIsInBhcmVudE5vZGUiLCJpc0JvbGQiLCJpc0l0YWxpYyIsImlzVW5kZXJsaW5lIiwiZm9udCIsImZvbnRTaXplIiwibGluZUhlaWdodCIsImNvbG9yIiwiY2xvc2VEcm9wZG93bnMiLCJjb250ZW50cyIsInNlbGVjdGlvbiIsImdldFNlbGVjdGVkTm9kZSIsIm5vZGVUeXBlIiwidGFnTmFtZSIsInRvTG93ZXJDYXNlIiwid2luZG93IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJpbmRleE9mIiwic2V0U3R5bGVzIiwiYm9sZCIsIml0YWxpYyIsInVuZGVybGluZSIsInNldEZvbnQiLCJzZXRGb250U2l6ZSIsInJlbW92ZUNsYXNzIiwicmVzdHJpY3QiLCJzY29wZSJdLCJtYXBwaW5ncyI6IkNBRUMsV0FDQyxZQUVBQSxTQUFRQyxPQUFPLHlDQUNaQyxVQUFVLFlBQWEsV0FNdEIsUUFBU0MsR0FBS0MsRUFBUUMsR0FDcEIsR0FBSUMsR0FBa0IsS0FBTUMsRUFBWSxHQUFJQyxFQUFNLElBRWxEQyxHQUFFSixHQUFTSyxXQUNUQyxZQUFlUCxFQUFPTyxjQUd4QkMsRUFBY0gsRUFBRSxnQkFDaEJJLEVBQW1CSixFQUFFLHFCQUNyQkssRUFBU0wsRUFBRSxhQUFhTSxLQUFLLGFBQWFELE9BRzFDVixFQUFPWSxJQUFJLHVCQUF3QixTQUFVQyxFQUFHQyxHQUM5Q0MsR0FBaUIsRUFDakJDLEVBQVNGLEVBRVRKLEVBQU9PLFNBQVNILEVBQWlCSCxNQUc3QkcsRUFBaUJJLGFBQ25CaEIsRUFBa0JpQixVQUFVTCxFQUFpQkksWUFDN0NmLEVBQVlELEVBQWdCa0IsY0FDNUJoQixFQUFNRixFQUFnQm1CLFFBRXRCWixFQUFpQmEsU0FBUyxNQUFPcEIsR0FDakNRLEVBQU9hLFNBQVNDLFNBQVNDLEtBQUssa0JBQW1CdEIsRUFBV0MsSUFDMURzQixLQUFNLHdCQUNOQyxNQUFPekIsRUFBZ0IwQixrQkFJM0JDLE1BR0Y3QixFQUFPWSxJQUFJLDBCQUEyQixXQUNwQ1YsRUFBa0JRLEVBQU9hLFNBQVNPLElBQUlDLEtBQ25DQyxhQUFhLHlCQUVoQmhDLEVBQU9pQyxRQUFRQyxtQkFBbUIsT0FBUXhCLEVBQU95QixZQUNqRG5DLEVBQU9pQyxRQUFRQyxtQkFBbUIsYUFDaENo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S0FBSyxlQUFpQixFQUV0Q04sRUFBRSx1QkFBdUJNLEtBQUssMEJBQzVCd0QsR0FHRkMsRUFBUVEsT0FBT0MsaUJBQWlCaEIsRUFBWSxNQUN6Q2lCLGlCQUFpQixTQUNwQnRDLEVBQWlCb0MsT0FBT0MsaUJBQWlCaEIsRUFBWSxNQUNsRGlCLGlCQUFpQixvQkFFaEJWLEdBQ0ZWLEVBQVdwQyxTQUFTLE1BQU84QyxHQUd6QjVCLEdBQ0ZtQixFQUFnQnJDLFNBQVMsTUFBT2tCLEtBS2xDZ0IsRUFBVzdDLEtBQUssb0JBQW9CcUUsV0FDbENDLE1BQVEsRUFDUkMsUUFBVSxFQUNWQyxXQUFhLElBSWY5RSxFQUFFLHVCQUF1Qk0sS0FBSywwQkFBMkIsUUFRbkUsUUFBUzBELEtBQ1BoRSxFQUFFLCtHQUVDaUYsWUFBWSxRQUNmakYsRUFBRSxlQUFlaUIsU0FBUyxRQUMxQmpCLEVBQUUsb0JBQW9CaUIsU0FBUyxRQUMvQmpCLEVBQUUscUJBQXFCaUIsU0FBUyxRQS9ObEMsR0FDSWQsR0FBYUMsRUFFYk8sRUFIQU4sRUFBUyxLQUVUMkIsR0FBaUIsRUFBT3RCLEdBQWlCLENBZ083QyxRQUNFd0UsU0FBVSxJQUNWQyxPQUNFakYsWUFBZSxJQUNmVyxXQUFjLElBQ2RQLEtBQVEsS0FFVlosS0FBTUEiLCJmaWxlIjoiZHR2LWJvb3RzdHJhcDMtd3lzaWh0bWw1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBhbmd1bGFyLCB0aW55Y29sb3IsICQgKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24ud3lzaWh0bWw1XCIsIFtdKVxuICAgIC5kaXJlY3RpdmUoXCJ3eXNpaHRtbDVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVkaXRvciA9IG51bGw7XG4gICAgICB2YXIgJGZvbnRQaWNrZXIsICRiYWNrZ3JvdW5kQ29sb3I7XG4gICAgICB2YXIgaXNFZGl0b3JMb2FkZWQgPSBmYWxzZSwgaXNQYXJhbXNMb2FkZWQgPSBmYWxzZTtcbiAgICAgIHZhciBwYXJhbXM7XG5cbiAgICAgIGZ1bmN0aW9uIGxpbmsoJHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBiYWNrZ3JvdW5kQ29sb3IgPSBudWxsLCBoZXhTdHJpbmcgPSBcIlwiLCByZ2IgPSBudWxsO1xuXG4gICAgICAgICQoZWxlbWVudCkud3lzaWh0bWw1KHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6ICRzY29wZS5zdHlsZXNoZWV0c1xuICAgICAgICB9KTtcblxuICAgICAgICAkZm9udFBpY2tlciA9ICQoXCIuZm9udC1waWNrZXJcIik7XG4gICAgICAgICRiYWNrZ3JvdW5kQ29sb3IgPSAkKFwiLmJhY2tncm91bmQtY29sb3JcIik7XG4gICAgICAgIGVkaXRvciA9ICQoXCIjZWRpdGFibGVcIikuZGF0YShcInd5c2lodG1sNVwiKS5lZGl0b3I7XG5cbiAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzLlxuICAgICAgICAkc2NvcGUuJG9uKFwibG9hZEFkZGl0aW9uYWxQYXJhbXNcIiwgZnVuY3Rpb24gKGUsIGFkZGl0aW9uYWxQYXJhbXMpIHtcbiAgICAgICAgICBpc1BhcmFtc0xvYWRlZCA9IHRydWU7XG4gICAgICAgICAgcGFyYW1zID0gYWRkaXRpb25hbFBhcmFtcztcblxuICAgICAgICAgIGVkaXRvci5zZXRWYWx1ZShhZGRpdGlvbmFsUGFyYW1zLmRhdGEpO1xuXG4gICAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgY29sb3IuXG4gICAgICAgICAgaWYgKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCkge1xuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gdGlueWNvbG9yKGFkZGl0aW9uYWxQYXJhbXMuYmFja2dyb3VuZCk7XG4gICAgICAgICAgICBoZXhTdHJpbmcgPSBiYWNrZ3JvdW5kQ29sb3IudG9IZXhTdHJpbmcoKTtcbiAgICAgICAgICAgIHJnYiA9IGJhY2tncm91bmRDb2xvci50b1JnYigpO1xuXG4gICAgICAgICAgICAkYmFja2dyb3VuZENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImJhY2tncm91bmRDb2xvclwiLCBoZXhTdHJpbmcsIHJnYiwgW3tcbiAgICAgICAgICAgICAgbmFtZTogXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIixcbiAgICAgICAgICAgICAgdmFsdWU6IGJhY2tncm91bmRDb2xvci50b1JnYlN0cmluZygpXG4gICAgICAgICAgICB9XSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaW5pdEVkaXRvcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkc2NvcGUuJG9uKFwiY29sbGVjdEFkZGl0aW9uYWxQYXJhbXNcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yID0gZWRpdG9yLmNvbXBvc2VyLmRvYy5ib2R5XG4gICAgICAgICAgICAuZ2V0QXR0cmlidXRlKFwiZGF0YS1iYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiZGF0YVwiLCBlZGl0b3IuZ2V0VmFsdWUoKSk7XG4gICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2V0QWRkaXRpb25hbFBhcmFtKFwiYmFja2dyb3VuZFwiLFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yID8gYmFja2dyb3VuZENvbG9yIDogXCJcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVkaXRvci5vbihcImxvYWRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaXNFZGl0b3JMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgIGJpbmQoKTtcbiAgICAgICAgICBpbml0RWRpdG9yKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBpbml0RWRpdG9yKCkge1xuICAgICAgICB2YXIgdGV4dENvbG9yLCBoaWdobGlnaHRDb2xvcjtcbiAgICAgICAgdmFyIHN0YW5kYXJkRm9udCwgZ29vZ2xlRm9udCwgY3VzdG9tRm9udDtcblxuICAgICAgICBpZiAoaXNFZGl0b3JMb2FkZWQgJiYgaXNQYXJhbXNMb2FkZWQpIHtcbiAgICAgICAgICAkLmVhY2goJChwYXJhbXMuZGF0YSkuZmluZChcInNwYW5cIikuYWRkQmFjaygpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHN0YW5kYXJkRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udFwiKTtcbiAgICAgICAgICAgIGdvb2dsZUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWdvb2dsZS1mb250XCIpO1xuICAgICAgICAgICAgY3VzdG9tRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnRcIik7XG4gICAgICAgICAgICB0ZXh0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXRleHQtY29sb3JcIik7XG4gICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9ICQodGhpcykuYXR0cihcImRhdGEtaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBzdGFuZGFyZCBmb250cy5cbiAgICAgICAgICAgIGlmIChzdGFuZGFyZEZvbnQpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJzdGFuZGFyZEZvbnRcIiwgc3RhbmRhcmRGb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udC1mYW1pbHlcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBHb29nbGUgZm9udHMuXG4gICAgICAgICAgICBpZiAoZ29vZ2xlRm9udCkge1xuICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAuYWRkR29vZ2xlRm9udChnb29nbGVGb250LCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgLy8gVGhpcyB3b24ndCBhZGQgYSBuZXcgc3BhbiB0YWcgYmVjYXVzZSBhIHJhbmdlIHdpbGwgbm90IGhhdmVcbiAgICAgICAgICAgICAgLy8gYmVlbiBzZWxlY3RlZCwgd2hpY2ggaXMgd2hhdCB3ZSB3YW50LlxuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImdvb2dsZUZvbnRcIiwgZ29vZ2xlRm9udCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYWQgYW5kIGFkZCBDU1MgZm9yIGN1c3RvbSBmb250cy5cbiAgICAgICAgICAgIGlmIChjdXN0b21Gb250KSB7XG4gICAgICAgICAgICAgIFJpc2VWaXNpb24uQ29tbW9uLlV0aWxpdGllcy5sb2FkQ3VzdG9tRm9udChjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpLFxuICAgICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5pZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJjdXN0b21Gb250XCIsIGN1c3RvbUZvbnQsXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1jdXN0b20tZm9udC11cmxcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBjb2xvcnMuXG4gICAgICAgICAgICBpZiAodGV4dENvbG9yKSB7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwidGV4dENvbG9yXCIsIHRleHRDb2xvcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImhpZ2hsaWdodENvbG9yXCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBiaW5kKCkge1xuICAgICAgICB2YXIgbm9kZSA9IG51bGwsIHBhcmVudE5vZGUgPSBudWxsO1xuICAgICAgICB2YXIgaXNCb2xkID0gZmFsc2UsIGlzSXRhbGljID0gZmFsc2UsIGlzVW5kZXJsaW5lID0gZmFsc2U7XG4gICAgICAgIHZhciBmb250ID0gXCJcIiwgZm9udFNpemUgPSBcIlwiLCBsaW5lSGVpZ2h0ID0gXCJcIjtcbiAgICAgICAgdmFyIGNvbG9yID0gXCJcIiwgaGlnaGxpZ2h0Q29sb3IgPSBcIlwiO1xuICAgICAgICB2YXIgJGZvbnRTdHlsZSwgJGZvbnRTaXplUGlja2VyO1xuICAgICAgICB2YXIgJHRleHRDb2xvciwgJGhpZ2hsaWdodENvbG9yO1xuXG4gICAgICAgICRmb250U3R5bGUgPSAkKFwiLmVtcGhhc2lzXCIpO1xuICAgICAgICAkZm9udFNpemVQaWNrZXIgPSAkKFwiLmZvbnQtc2l6ZS1waWNrZXJcIik7XG4gICAgICAgICR0ZXh0Q29sb3IgPSAkKFwiLnRleHQtY29sb3JcIik7XG4gICAgICAgICRoaWdobGlnaHRDb2xvciA9ICQoXCIuaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBoYW5kbGVycyB0byB0b29sYmFyIGFuZCBlZGl0b3IuXG4gICAgICAgICQoXCIuZm9udC1waWNrZXJcIikub24oXCJzaG93LmJmaHNlbGVjdGJveFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiLmZvbnQtc2l6ZS1waWNrZXIsIC5saW5lLWhlaWdodCwgLmFsaWdubWVudFwiKS5vbihcInNob3cuYnMuZHJvcGRvd25cIixcbiAgICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgICQoXCIudGV4dC1jb2xvciwgLmhpZ2hsaWdodC1jb2xvciwgLmJhY2tncm91bmQtY29sb3JcIilcbiAgICAgICAgICAub24oXCJiZWZvcmVTaG93XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gV2hlbiB0aGUgdXNlciBjbGlja3MgaW4gdGhlIGVkaXRvciwgc2V0IHRvb2xiYXIgdG8gbWF0Y2ggdGV4dCBzdHlsZXMuXG4gICAgICAgICQoXCIud3lzaWh0bWw1LXNhbmRib3hcIikuY29udGVudHMoKS5maW5kKFwiYm9keVwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG5cbiAgICAgICAgICBub2RlID0gZWRpdG9yLmNvbXBvc2VyLnNlbGVjdGlvbi5nZXRTZWxlY3RlZE5vZGUoKTtcblxuICAgICAgICAgIC8vIFRoZSBzZWxlY3RlZCBub2RlIGlzIGEgdGV4dCBub2RlLlxuICAgICAgICAgIGlmIChub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDMpIHtcbiAgICAgICAgICAgIHBhcmVudE5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG5cbiAgICAgICAgICAgIC8vIFRoZSBwYXJlbnQgbm9kZSBpcyBhbiBlbGVtZW50LlxuICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgICAvLyBUaGUgcGFyZW50IG5vZGUgaXMgbm90IHRoZSBlZGl0b3IgZWxlbWVudCBpdHNlbGYuXG4gICAgICAgICAgICAgIGlmIChwYXJlbnROb2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPT0gXCJib2R5XCIpIHtcbiAgICAgICAgICAgICAgICAvLyBGb250IFN0eWxlXG4gICAgICAgICAgICAgICAgaXNCb2xkID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC13ZWlnaHRcIikgPT09IFwiYm9sZFwiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzSXRhbGljID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC1zdHlsZVwiKSA9PT0gXCJpdGFsaWNcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc1VuZGVybGluZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcInRleHQtZGVjb3JhdGlvblwiKS5pbmRleE9mKFwidW5kZXJsaW5lXCIpICE9PSAtMSA/IHRydWUgOiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICRmb250U3R5bGUuZGF0YShcInBsdWdpbl9mb250U3R5bGVcIikuc2V0U3R5bGVzKHtcbiAgICAgICAgICAgICAgICAgIFwiYm9sZFwiOiBpc0JvbGQsXG4gICAgICAgICAgICAgICAgICBcIml0YWxpY1wiOiBpc0l0YWxpYyxcbiAgICAgICAgICAgICAgICAgIFwidW5kZXJsaW5lXCI6IGlzVW5kZXJsaW5lXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBGb250XG4gICAgICAgICAgICAgICAgZm9udCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtZmFtaWx5XCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZvbnQpIHtcbiAgICAgICAgICAgICAgICAgICRmb250UGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFBpY2tlclwiKS5zZXRGb250KGZvbnQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEZvbnQgc2l6ZVxuICAgICAgICAgICAgICAgIGZvbnRTaXplID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC1zaXplXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZvbnRTaXplKSB7XG4gICAgICAgICAgICAgICAgICAkZm9udFNpemVQaWNrZXIuZGF0YShcInBsdWdpbl9mb250U2l6ZVBpY2tlclwiKVxuICAgICAgICAgICAgICAgICAgICAuc2V0Rm9udFNpemUoZm9udFNpemUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIExpbmUgSGVpZ2h0XG4gICAgICAgICAgICAgICAgbGluZUhlaWdodCA9ICQocGFyZW50Tm9kZSkuZGF0YShcImxpbmUtaGVpZ2h0XCIpID9cbiAgICAgICAgICAgICAgICAgICQocGFyZW50Tm9kZSkuZGF0YShcImxpbmUtaGVpZ2h0XCIpIDogMTtcblxuICAgICAgICAgICAgICAgICQoXCIubGluZS1oZWlnaHQgYnV0dG9uXCIpLmRhdGEoXCJ3eXNpaHRtbDUtY29tbWFuZC12YWx1ZVwiLFxuICAgICAgICAgICAgICAgICAgbGluZUhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDb2xvcnNcbiAgICAgICAgICAgICAgICBjb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImNvbG9yXCIpO1xuICAgICAgICAgICAgICAgIGhpZ2hsaWdodENvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiYmFja2dyb3VuZC1jb2xvclwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChjb2xvcikge1xuICAgICAgICAgICAgICAgICAgJHRleHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBjb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodENvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAkaGlnaGxpZ2h0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgaGlnaGxpZ2h0Q29sb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBSZXNldCBmb250IHN0eWxlLlxuICAgICAgICAgICAgICAgICRmb250U3R5bGUuZGF0YShcInBsdWdpbl9mb250U3R5bGVcIikuc2V0U3R5bGVzKHtcbiAgICAgICAgICAgICAgICAgIFwiYm9sZFwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIFwiaXRhbGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgXCJ1bmRlcmxpbmVcIjogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGxpbmUgaGVpZ2h0LlxuICAgICAgICAgICAgICAgICQoXCIubGluZS1oZWlnaHQgYnV0dG9uXCIpLmRhdGEoXCJ3eXNpaHRtbDUtY29tbWFuZC12YWx1ZVwiLCAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsb3NlIGFsbCBvcGVuIGRyb3Bkb3ducy5cbiAgICAgIGZ1bmN0aW9uIGNsb3NlRHJvcGRvd25zKCkge1xuICAgICAgICAkKFwiLm9wZW4uYWxpZ25tZW50LCAuZm9udC1waWNrZXIgLm9wZW4uYmZoLXNlbGVjdGJveCwgXCIgK1xuICAgICAgICAgIFwiLmZvbnQtc2l6ZS1waWNrZXIgLm9wZW4uYmZoLWZvbnRzaXplcywgLm9wZW4ubGluZS1oZWlnaHRcIilcbiAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAkKFwiLnRleHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmhpZ2hsaWdodC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICAgICQoXCIuYmFja2dyb3VuZC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkFcIixcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6IFwiPVwiLFxuICAgICAgICAgIFwiYmFja2dyb3VuZFwiOiBcIj1cIixcbiAgICAgICAgICBcImRhdGFcIjogXCI9XCJcbiAgICAgICAgfSxcbiAgICAgICAgbGluazogbGlua1xuICAgICAgfTtcbiAgICB9KTtcbn0oKSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=