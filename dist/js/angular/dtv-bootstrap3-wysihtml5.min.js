!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,n){var m=null,g=null;$(n).wysihtml5({stylesheets:t.stylesheets}),a=$(".font-picker"),i=$(".background-color"),l=$(".text-color"),r=$(".highlight-color"),d=$("#editable").data("wysihtml5").editor,t.$on("loadAdditionalParams",function(t,o){u=!0,c=o,d.setValue(o.data),o.background&&(m=tinycolor(o.background),g=m.toRgb(),i.spectrum("set",m),d.composer.commands.exec("backgroundColor",g,[{name:"data-background-color",value:m.toRgbString()}])),e()}),t.$on("collectAdditionalParams",function(){m=d.composer.doc.body.getAttribute("data-background-color"),t.$parent.setAdditionalParam("data",d.getValue()),t.$parent.setAdditionalParam("background",m?m:"")}),d.on("load",function(){s=!0,o(),e()})}function e(){var t,e,o,n,i;s&&u&&$.each($("<div/>").html(c.data).find("span").addBack(),function(){o=$(this).attr("data-standard-font"),n=$(this).attr("data-google-font"),i=$(this).attr("data-custom-font"),t=$(this).attr("data-text-color"),e=$(this).attr("data-highlight-color"),o&&d.composer.commands.exec("standardFont",o,$(this).attr("data-standard-font-family")),n&&(a.data("plugin_fontPicker").addGoogleFont(n,!1),d.composer.commands.exec("googleFont",n)),i&&(RiseVision.Common.Utilities.loadCustomFont(i,$(this).attr("data-custom-font-url"),d.composer.iframe.contentDocument),d.composer.commands.exec("customFont",i,$(this).attr("data-custom-font-url"))),t&&(l.spectrum("set",t),d.composer.commands.exec("textColor",l.spectrum("get").toRgb())),e&&(r.spectrum("set",e),d.composer.commands.exec("highlightColor",r.spectrum("get").toRgb()))})}function o(){var t=null,e=null,o=!1,i=!1,c=!1,s="",u="",m="",g="",p="",h="",f=$(".emphasis"),y=$(".font-size-picker"),b=$(".alignment");$(".font-picker").on("show.bfhselectbox",function(){n()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){n()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){n()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){n(),t=d.composer.selection.getSelectedNode(),t&&3===t.nodeType&&(e=t.parentNode,e&&1===e.nodeType&&("body"!==e.tagName.toLowerCase()?(o="bold"===window.getComputedStyle(e,null).getPropertyValue("font-weight")?!0:!1,i="italic"===window.getComputedStyle(e,null).getPropertyValue("font-style")?!0:!1,c=-1!==window.getComputedStyle(e,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,f.data("plugin_fontStyle").setStyles({bold:o,italic:i,underline:c}),s=window.getComputedStyle(e,null).getPropertyValue("font-family"),s&&a.data("plugin_fontPicker").setFont(s),u=window.getComputedStyle(e,null).getPropertyValue("font-size"),u&&y.data("plugin_fontSizePicker").setFontSize(u),m=window.getComputedStyle(e,null).getPropertyValue("text-align"),m&&b.data("plugin_alignment").setAlignment(m),g=$(e).data("line-height")?$(e).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",g),p=window.getComputedStyle(e,null).getPropertyValue("color"),h=window.getComputedStyle(e,null).getPropertyValue("background-color"),p&&l.spectrum("set",p),h&&r.spectrum("set",h)):(a.data("plugin_fontPicker").reset(),y.data("plugin_fontSizePicker").reset(),f.data("plugin_fontStyle").reset(),b.data("plugin_alignment").reset(),$(".line-height a[data-wysihtml5-command-value='1']").trigger("click"),l.spectrum("set","#000"),r.spectrum("set","#fff"))))})}function n(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var a,i,l,r,c,d=null,s=!1,u=!1;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJyZ2JhIiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiJHRleHRDb2xvciIsIiRoaWdobGlnaHRDb2xvciIsImVkaXRvciIsImRhdGEiLCIkb24iLCJlIiwiYWRkaXRpb25hbFBhcmFtcyIsImlzUGFyYW1zTG9hZGVkIiwicGFyYW1zIiwic2V0VmFsdWUiLCJiYWNrZ3JvdW5kIiwidGlueWNvbG9yIiwidG9SZ2IiLCJzcGVjdHJ1bSIsImNvbXBvc2VyIiwiY29tbWFuZHMiLCJleGVjIiwibmFtZSIsInZhbHVlIiwidG9SZ2JTdHJpbmciLCJpbml0RWRpdG9yIiwiZG9jIiwiYm9keSIsImdldEF0dHJpYnV0ZSIsIiRwYXJlbnQiLCJzZXRBZGRpdGlvbmFsUGFyYW0iLCJnZXRWYWx1ZSIsIm9uIiwiaXNFZGl0b3JMb2FkZWQiLCJiaW5kIiwidGV4dENvbG9yIiwiaGlnaGxpZ2h0Q29sb3IiLCJzdGFuZGFyZEZvbnQiLCJnb29nbGVGb250IiwiY3VzdG9tRm9udCIsImVhY2giLCJodG1sIiwiZmluZCIsImFkZEJhY2siLCJ0aGlzIiwiYXR0ciIsImFkZEdvb2dsZUZvbnQiLCJSaXNlVmlzaW9uIiwiQ29tbW9uIiwiVXRpbGl0aWVzIiwibG9hZEN1c3RvbUZvbnQiLCJpZnJhbWUiLCJjb250ZW50RG9jdW1lbnQiLCJub2RlIiwicGFyZW50Tm9kZSIsImlzQm9sZCIsImlzSXRhbGljIiwiaXNVbmRlcmxpbmUiLCJmb250IiwiZm9udFNpemUiLCJhbGlnbm1lbnQiLCJsaW5lSGVpZ2h0IiwiY29sb3IiLCIkZm9udFN0eWxlIiwiJGZvbnRTaXplUGlja2VyIiwiJGFsaWdubWVudCIsImNsb3NlRHJvcGRvd25zIiwiY29udGVudHMiLCJzZWxlY3Rpb24iLCJnZXRTZWxlY3RlZE5vZGUiLCJub2RlVHlwZSIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiaW5kZXhPZiIsInNldFN0eWxlcyIsImJvbGQiLCJpdGFsaWMiLCJ1bmRlcmxpbmUiLCJzZXRGb250Iiwic2V0Rm9udFNpemUiLCJzZXRBbGlnbm1lbnQiLCJyZXNldCIsInRyaWdnZXIiLCJyZW1vdmVDbGFzcyIsInJlc3RyaWN0Iiwic2NvcGUiXSwibWFwcGluZ3MiOiJDQUVDLFdBQ0MsWUFFQUEsU0FBUUMsT0FBTyx5Q0FDWkMsVUFBVSxZQUFhLFdBTXRCLFFBQVNDLEdBQUtDLEVBQVFDLEdBQ3BCLEdBQUlDLEdBQWtCLEtBQU1DLEVBQU8sSUFFbkNDLEdBQUVILEdBQVNJLFdBQ1RDLFlBQWVOLEVBQU9NLGNBR3hCQyxFQUFjSCxFQUFFLGdCQUNoQkksRUFBbUJKLEVBQUUscUJBQ3JCSyxFQUFhTCxFQUFFLGVBQ2ZNLEVBQWtCTixFQUFFLG9CQUNwQk8sRUFBU1AsRUFBRSxhQUFhUSxLQUFLLGFBQWFELE9BRzFDWCxFQUFPYSxJQUFJLHVCQUF3QixTQUFVQyxFQUFHQyxHQUM5Q0MsR0FBaUIsRUFDakJDLEVBQVNGLEVBRVRKLEVBQU9PLFNBQVNILEVBQWlCSCxNQUc3QkcsRUFBaUJJLGFBQ25CakIsRUFBa0JrQixVQUFVTCxFQUFpQkksWUFDN0NoQixFQUFPRCxFQUFnQm1CLFFBRXZCYixFQUFpQmMsU0FBUyxNQUFPcEIsR0FFakNTLEVBQU9ZLFNBQVNDLFNBQVNDLEtBQUssa0JBQW1CdEIsSUFDN0N1QixLQUFNLHdCQUNOQyxNQUFPekIsRUFBZ0IwQixrQkFJN0JDLE1BR0Y3QixFQUFPYSxJQUFJLDBCQUEyQixXQUNwQ1gsRUFBa0JTLEVBQU9ZLFNBQVNPLElBQUlDLEtBQ25DQyxhQUFhLHlCQUVoQmhDLEVBQU9pQyxRQUFRQyxtQkFBbUIsT0FBUXZCLEVB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aWh0bWw1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBhbmd1bGFyLCB0aW55Y29sb3IsICQgKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24ud3lzaWh0bWw1XCIsIFtdKVxuICAgIC5kaXJlY3RpdmUoXCJ3eXNpaHRtbDVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVkaXRvciA9IG51bGw7XG4gICAgICB2YXIgJGZvbnRQaWNrZXIsICRiYWNrZ3JvdW5kQ29sb3IsICR0ZXh0Q29sb3IsICRoaWdobGlnaHRDb2xvcjtcbiAgICAgIHZhciBpc0VkaXRvckxvYWRlZCA9IGZhbHNlLCBpc1BhcmFtc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgdmFyIHBhcmFtcztcblxuICAgICAgZnVuY3Rpb24gbGluaygkc2NvcGUsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGJhY2tncm91bmRDb2xvciA9IG51bGwsIHJnYmEgPSBudWxsO1xuXG4gICAgICAgICQoZWxlbWVudCkud3lzaWh0bWw1KHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6ICRzY29wZS5zdHlsZXNoZWV0c1xuICAgICAgICB9KTtcblxuICAgICAgICAkZm9udFBpY2tlciA9ICQoXCIuZm9udC1waWNrZXJcIik7XG4gICAgICAgICRiYWNrZ3JvdW5kQ29sb3IgPSAkKFwiLmJhY2tncm91bmQtY29sb3JcIik7XG4gICAgICAgICR0ZXh0Q29sb3IgPSAkKFwiLnRleHQtY29sb3JcIik7XG4gICAgICAgICRoaWdobGlnaHRDb2xvciA9ICQoXCIuaGlnaGxpZ2h0LWNvbG9yXCIpO1xuICAgICAgICBlZGl0b3IgPSAkKFwiI2VkaXRhYmxlXCIpLmRhdGEoXCJ3eXNpaHRtbDVcIikuZWRpdG9yO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBoYW5kbGVycy5cbiAgICAgICAgJHNjb3BlLiRvbihcImxvYWRBZGRpdGlvbmFsUGFyYW1zXCIsIGZ1bmN0aW9uIChlLCBhZGRpdGlvbmFsUGFyYW1zKSB7XG4gICAgICAgICAgaXNQYXJhbXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgIHBhcmFtcyA9IGFkZGl0aW9uYWxQYXJhbXM7XG5cbiAgICAgICAgICBlZGl0b3Iuc2V0VmFsdWUoYWRkaXRpb25hbFBhcmFtcy5kYXRhKTtcblxuICAgICAgICAgIC8vIFNldCBiYWNrZ3JvdW5kIGNvbG9yLlxuICAgICAgICAgIGlmIChhZGRpdGlvbmFsUGFyYW1zLmJhY2tncm91bmQpIHtcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IHRpbnljb2xvcihhZGRpdGlvbmFsUGFyYW1zLmJhY2tncm91bmQpO1xuICAgICAgICAgICAgcmdiYSA9IGJhY2tncm91bmRDb2xvci50b1JnYigpO1xuXG4gICAgICAgICAgICAkYmFja2dyb3VuZENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGJhY2tncm91bmRDb2xvcik7XG5cbiAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiYmFja2dyb3VuZENvbG9yXCIsIHJnYmEsIFt7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogYmFja2dyb3VuZENvbG9yLnRvUmdiU3RyaW5nKClcbiAgICAgICAgICAgICAgfV0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGluaXRFZGl0b3IoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbihcImNvbGxlY3RBZGRpdGlvbmFsUGFyYW1zXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IGVkaXRvci5jb21wb3Nlci5kb2MuYm9keVxuICAgICAgICAgICAgLmdldEF0dHJpYnV0ZShcImRhdGEtYmFja2dyb3VuZC1jb2xvclwiKTtcblxuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImRhdGFcIiwgZWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImJhY2tncm91bmRcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA/IGJhY2tncm91bmRDb2xvciA6IFwiXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBlZGl0b3Iub24oXCJsb2FkXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlzRWRpdG9yTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICBiaW5kKCk7XG4gICAgICAgICAgaW5pdEVkaXRvcigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gaW5pdEVkaXRvcigpIHtcbiAgICAgICAgdmFyIHRleHRDb2xvciwgaGlnaGxpZ2h0Q29sb3I7XG4gICAgICAgIHZhciBzdGFuZGFyZEZvbnQsIGdvb2dsZUZvbnQsIGN1c3RvbUZvbnQ7XG5cbiAgICAgICAgaWYgKGlzRWRpdG9yTG9hZGVkICYmIGlzUGFyYW1zTG9hZGVkKSB7XG4gICAgICAgICAgJC5lYWNoKCQoXCI8ZGl2Lz5cIikuaHRtbChwYXJhbXMuZGF0YSkuZmluZChcInNwYW5cIikuYWRkQmFjaygpLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHN0YW5kYXJkRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udFwiKTtcbiAgICAgICAgICAgIGdvb2dsZUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWdvb2dsZS1mb250XCIpO1xuICAgICAgICAgICAgY3VzdG9tRm9udCA9ICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnRcIik7XG4gICAgICAgICAgICB0ZXh0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXRleHQtY29sb3JcIik7XG4gICAgICAgICAgICBoaWdobGlnaHRDb2xvciA9ICQodGhpcykuYXR0cihcImRhdGEtaGlnaGxpZ2h0LWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBzdGFuZGFyZCBmb250cy5cbiAgICAgICAgICAgIGlmIChzdGFuZGFyZEZvbnQpIHtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJzdGFuZGFyZEZvbnRcIiwgc3RhbmRhcmRGb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtc3RhbmRhcmQtZm9udC1mYW1pbHlcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBHb29nbGUgZm9udHMuXG4gICAgICAgICAgICBpZiAoZ29vZ2xlRm9udCkge1xuICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAuYWRkR29vZ2xlRm9udChnb29nbGVGb250LCBmYWxzZSk7XG5cbiAgICAgICAgICAgICAgLy8gVGhpcyB3b24ndCBhZGQgYSBuZXcgc3BhbiB0YWcgYmVjYXVzZSBhIHJhbmdlIHdpbGwgbm90IGhhdmVcbiAgICAgICAgICAgICAgLy8gYmVlbiBzZWxlY3RlZCwgd2hpY2ggaXMgd2hhdCB3ZSB3YW50LlxuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImdvb2dsZUZvbnRcIiwgZ29vZ2xlRm9udCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIExvYWQgYW5kIGFkZCBDU1MgZm9yIGN1c3RvbSBmb250cy5cbiAgICAgICAgICAgIGlmIChjdXN0b21Gb250KSB7XG4gICAgICAgICAgICAgIFJpc2VWaXNpb24uQ29tbW9uLlV0aWxpdGllcy5sb2FkQ3VzdG9tRm9udChjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpLFxuICAgICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5pZnJhbWUuY29udGVudERvY3VtZW50KTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJjdXN0b21Gb250XCIsIGN1c3RvbUZvbnQsXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKFwiZGF0YS1jdXN0b20tZm9udC11cmxcIikpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBZGQgQ1NTIGZvciBjb2xvcnMuXG4gICAgICAgICAgICBpZiAodGV4dENvbG9yKSB7XG4gICAgICAgICAgICAgIC8vIFVzZSBjb2xvciBwaWNrZXIgYXMgYW4gaW50ZXJtZWRpYXJ5IHRvIGdldCB0aGUgY29sb3IgYXMgYW5cbiAgICAgICAgICAgICAgLy8gb2JqZWN0IGZvciBwYXNzaW5nIHRvIHRoZSBlZGl0b3IgY29tbWFuZC5cbiAgICAgICAgICAgICAgJHRleHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCB0ZXh0Q29sb3IpO1xuICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcInRleHRDb2xvclwiLFxuICAgICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJnZXRcIikudG9SZ2IoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChoaWdobGlnaHRDb2xvcikge1xuICAgICAgICAgICAgICAvLyBVc2UgY29sb3IgcGlja2VyIGFzIGFuIGludGVybWVkaWFyeS5cbiAgICAgICAgICAgICAgJGhpZ2hsaWdodENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGhpZ2hsaWdodENvbG9yKTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJoaWdobGlnaHRDb2xvclwiLFxuICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcImdldFwiKS50b1JnYigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBiaW5kKCkge1xuICAgICAgICB2YXIgbm9kZSA9IG51bGwsIHBhcmVudE5vZGUgPSBudWxsO1xuICAgICAgICB2YXIgaXNCb2xkID0gZmFsc2UsIGlzSXRhbGljID0gZmFsc2UsIGlzVW5kZXJsaW5lID0gZmFsc2U7XG4gICAgICAgIHZhciBmb250ID0gXCJcIiwgZm9udFNpemUgPSBcIlwiLCBhbGlnbm1lbnQgPSBcIlwiLCBsaW5lSGVpZ2h0ID0gXCJcIjtcbiAgICAgICAgdmFyIGNvbG9yID0gXCJcIiwgaGlnaGxpZ2h0Q29sb3IgPSBcIlwiO1xuICAgICAgICB2YXIgJGZvbnRTdHlsZSA9ICQoXCIuZW1waGFzaXNcIilcbiAgICAgICAgdmFyICRmb250U2l6ZVBpY2tlciA9ICQoXCIuZm9udC1zaXplLXBpY2tlclwiKTtcbiAgICAgICAgdmFyICRhbGlnbm1lbnQgPSAkKFwiLmFsaWdubWVudFwiKTtcblxuICAgICAgICAvLyBBZGQgZXZlbnQgaGFuZGxlcnMgdG8gdG9vbGJhciBhbmQgZWRpdG9yLlxuICAgICAgICAkKFwiLmZvbnQtcGlja2VyXCIpLm9uKFwic2hvdy5iZmhzZWxlY3Rib3hcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChcIi5mb250LXNpemUtcGlja2VyLCAubGluZS1oZWlnaHQsIC5hbGlnbm1lbnRcIikub24oXCJzaG93LmJzLmRyb3Bkb3duXCIsXG4gICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAkKFwiLnRleHQtY29sb3IsIC5oaWdobGlnaHQtY29sb3IsIC5iYWNrZ3JvdW5kLWNvbG9yXCIpXG4gICAgICAgICAgLm9uKFwiYmVmb3JlU2hvd1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFdoZW4gdGhlIHVzZXIgY2xpY2tzIGluIHRoZSBlZGl0b3IsIHNldCB0b29sYmFyIHRvIG1hdGNoIHRleHQgc3R5bGVzLlxuICAgICAgICAkKFwiLnd5c2lodG1sNS1zYW5kYm94XCIpLmNvbnRlbnRzKCkuZmluZChcImJvZHlcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuXG4gICAgICAgICAgbm9kZSA9IGVkaXRvci5jb21wb3Nlci5zZWxlY3Rpb24uZ2V0U2VsZWN0ZWROb2RlKCk7XG5cbiAgICAgICAgICAvLyBUaGUgc2VsZWN0ZWQgbm9kZSBpcyBhIHRleHQgbm9kZS5cbiAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm5vZGVUeXBlID09PSAzKSB7XG4gICAgICAgICAgICBwYXJlbnROb2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICAgICAgICAvLyBUaGUgcGFyZW50IG5vZGUgaXMgYW4gZWxlbWVudC5cbiAgICAgICAgICAgIGlmIChwYXJlbnROb2RlICYmIHBhcmVudE5vZGUubm9kZVR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIG5vdCB0aGUgZWRpdG9yIGVsZW1lbnQgaXRzZWxmLlxuICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09IFwiYm9keVwiKSB7XG4gICAgICAgICAgICAgICAgLy8gRm9udCBTdHlsZVxuICAgICAgICAgICAgICAgIGlzQm9sZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtd2VpZ2h0XCIpID09PSBcImJvbGRcIiA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpc0l0YWxpYyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc3R5bGVcIikgPT09IFwiaXRhbGljXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNVbmRlcmxpbmUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJ0ZXh0LWRlY29yYXRpb25cIikuaW5kZXhPZihcInVuZGVybGluZVwiKSAhPT0gLTEgPyB0cnVlIDogZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAkZm9udFN0eWxlLmRhdGEoXCJwbHVnaW5fZm9udFN0eWxlXCIpLnNldFN0eWxlcyh7XG4gICAgICAgICAgICAgICAgICBcImJvbGRcIjogaXNCb2xkLFxuICAgICAgICAgICAgICAgICAgXCJpdGFsaWNcIjogaXNJdGFsaWMsXG4gICAgICAgICAgICAgICAgICBcInVuZGVybGluZVwiOiBpc1VuZGVybGluZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gRm9udFxuICAgICAgICAgICAgICAgIGZvbnQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LWZhbWlseVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250KSB7XG4gICAgICAgICAgICAgICAgICAkZm9udFBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRQaWNrZXJcIikuc2V0Rm9udChmb250KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBGb250IHNpemVcbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImZvbnQtc2l6ZVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb250U2l6ZSkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRTaXplUGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFNpemVQaWNrZXJcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEZvbnRTaXplKGZvbnRTaXplKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBbGlnbm1lbnRcbiAgICAgICAgICAgICAgICBhbGlnbm1lbnQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJ0ZXh0LWFsaWduXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFsaWdubWVudCkge1xuICAgICAgICAgICAgICAgICAgJGFsaWdubWVudC5kYXRhKFwicGx1Z2luX2FsaWdubWVudFwiKVxuICAgICAgICAgICAgICAgICAgICAuc2V0QWxpZ25tZW50KGFsaWdubWVudCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTGluZSBIZWlnaHRcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgP1xuICAgICAgICAgICAgICAgICAgJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgOiAxO1xuXG4gICAgICAgICAgICAgICAgJChcIi5saW5lLWhlaWdodCBidXR0b25cIikuZGF0YShcInd5c2lodG1sNS1jb21tYW5kLXZhbHVlXCIsXG4gICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIC8vIENvbG9yc1xuICAgICAgICAgICAgICAgIGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiY29sb3JcIik7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAkdGV4dENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGFsbCB0b29sYmFyIGljb25zLlxuICAgICAgICAgICAgICAgICRmb250UGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFBpY2tlclwiKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICRmb250U2l6ZVBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRTaXplUGlja2VyXCIpLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICRhbGlnbm1lbnQuZGF0YShcInBsdWdpbl9hbGlnbm1lbnRcIikucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGFbZGF0YS13eXNpaHRtbDUtY29tbWFuZC12YWx1ZT0nMSddXCIpXG4gICAgICAgICAgICAgICAgICAudHJpZ2dlcihcImNsaWNrXCIpO1xuXG4gICAgICAgICAgICAgICAgJHRleHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBcIiMwMDBcIik7XG4gICAgICAgICAgICAgICAgJGhpZ2hsaWdodENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIFwiI2ZmZlwiKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsb3NlIGFsbCBvcGVuIGRyb3Bkb3ducy5cbiAgICAgIGZ1bmN0aW9uIGNsb3NlRHJvcGRvd25zKCkge1xuICAgICAgICAkKFwiLm9wZW4uYWxpZ25tZW50LCAuZm9udC1waWNrZXIgLm9wZW4uYmZoLXNlbGVjdGJveCwgXCIgK1xuICAgICAgICAgIFwiLmZvbnQtc2l6ZS1waWNrZXIgLm9wZW4uYmZoLWZvbnRzaXplcywgLm9wZW4ubGluZS1oZWlnaHRcIilcbiAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAkKFwiLnRleHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmhpZ2hsaWdodC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICAgICQoXCIuYmFja2dyb3VuZC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkFcIixcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6IFwiPVwiLFxuICAgICAgICAgIFwiYmFja2dyb3VuZFwiOiBcIj1cIixcbiAgICAgICAgICBcImRhdGFcIjogXCI9XCJcbiAgICAgICAgfSxcbiAgICAgICAgbGluazogbGlua1xuICAgICAgfTtcbiAgICB9KTtcbn0oKSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=