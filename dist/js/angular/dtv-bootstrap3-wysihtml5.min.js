!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,n){var m=null,g=null;$(n).wysihtml5({stylesheets:t.stylesheets}),a=$(".font-picker"),i=$(".background-color"),l=$(".text-color"),r=$(".highlight-color"),d=$("#editable").data("wysihtml5").editor,t.$on("loadAdditionalParams",function(t,o){u=!0,c=o,d.setValue(o.data),o.background&&(m=tinycolor(o.background),g=m.toRgb(),i.spectrum("set",m),d.composer.commands.exec("backgroundColor",g,[{name:"data-background-color",value:m.toRgbString()}])),e()}),t.$on("collectAdditionalParams",function(){m=d.composer.doc.body.getAttribute("data-background-color"),t.$parent.setAdditionalParam("data",d.getValue()),t.$parent.setAdditionalParam("background",m?m:"")}),d.on("load",function(){s=!0,o(),e()})}function e(){var t,e,o,n,i;s&&u&&$.each($("<div/>").html(c.data).find("span").addBack(),function(){o=$(this).attr("data-standard-font"),n=$(this).attr("data-google-font"),i=$(this).attr("data-custom-font"),t=$(this).attr("data-text-color"),e=$(this).attr("data-highlight-color"),o&&d.composer.commands.exec("standardFont",o,$(this).attr("data-standard-font-family")),n&&(a.data("plugin_fontPicker").addGoogleFont(n,!1),d.composer.commands.exec("googleFont",n)),i&&(RiseVision.Common.Utilities.loadCustomFont(i,$(this).attr("data-custom-font-url"),d.composer.iframe.contentDocument),d.composer.commands.exec("customFont",i,$(this).attr("data-custom-font-url"))),t&&(l.spectrum("set",t),d.composer.commands.exec("textColor",l.spectrum("get").toRgb())),e&&(r.spectrum("set",e),d.composer.commands.exec("highlightColor",r.spectrum("get").toRgb()))})}function o(){var t=null,e=null,o=!1,i=!1,c=!1,s="",u="",m="",g="",p="",h="",f=$(".emphasis"),y=$(".font-size-picker"),b=$(".alignment");$(".font-picker").on("show.bfhselectbox",function(){n()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){n()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){n()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){n(),t=d.composer.selection.getSelectedNode(),t&&3===t.nodeType&&(e=t.parentNode,e&&1===e.nodeType&&("body"!==e.tagName.toLowerCase()?(o="bold"===window.getComputedStyle(e,null).getPropertyValue("font-weight")?!0:!1,i="italic"===window.getComputedStyle(e,null).getPropertyValue("font-style")?!0:!1,c=-1!==window.getComputedStyle(e,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,f.data("plugin_fontStyle").setStyles({bold:o,italic:i,underline:c}),s=window.getComputedStyle(e,null).getPropertyValue("font-family"),s&&a.data("plugin_fontPicker").setFont(s),u=window.getComputedStyle(e,null).getPropertyValue("font-size"),u&&y.data("plugin_fontSizePicker").setFontSize(u),m=window.getComputedStyle(e,null).getPropertyValue("text-align"),m=-1===$.inArray(m,["left","center","right","justify"])?"left":m,m&&b.data("plugin_alignment").setAlignment(m),g=$(e).data("line-height")?$(e).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",g),p=window.getComputedStyle(e,null).getPropertyValue("color"),h=window.getComputedStyle(e,null).getPropertyValue("background-color"),p&&l.spectrum("set",p),h&&r.spectrum("set",h)):(a.data("plugin_fontPicker").reset(),y.data("plugin_fontSizePicker").reset(),f.data("plugin_fontStyle").reset(),b.data("plugin_alignment").reset(),$(".line-height button").data("wysihtml5-command-value","1"),l.spectrum("set","#000"),r.spectrum("set","#fff"))))})}function n(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var a,i,l,r,c,d=null,s=!1,u=!1;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJyZ2JhIiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiJHRleHRDb2xvciIsIiRoaWdobGlnaHRDb2xvciIsImVkaXRvciIsImRhdGEiLCIkb24iLCJlIiwiYWRkaXRpb25hbFBhcmFtcyIsImlzUGFyYW1zTG9hZGVkIiwicGFyYW1zIiwic2V0VmFsdWUiLCJiYWNrZ3JvdW5kIiwidGlueWNvbG9yIiwidG9SZ2IiLCJzcGVjdHJ1bSIsImNvbXBvc2VyIiwiY29tbWFuZHMiLCJleGVjIiwibmFtZSIsInZhbHVlIiwidG9SZ2JTdHJpbmciLCJpbml0RWRpdG9yIiwiZG9jIiwiYm9keSIsImdldEF0dHJpYnV0ZSIsIiRwYXJlbnQiLCJzZXRBZGRpdGlvbmFsUGFyYW0iLCJnZXRWYWx1ZSIsIm9uIiwiaXNFZGl0b3JMb2FkZWQiLCJiaW5kIiwidGV4dENvbG9yIiwiaGlnaGxpZ2h0Q29sb3IiLCJzdGFuZGFyZEZvbnQiLCJnb29nbGVGb250IiwiY3VzdG9tRm9udCIsImVhY2giLCJodG1sIiwiZmluZCIsImFkZEJhY2siLCJ0aGlzIiwiYXR0ciIsImFkZEdvb2dsZUZvbnQiLCJSaXNlVmlzaW9uIiwiQ29tbW9uIiwiVXRpbGl0aWVzIiwibG9hZEN1c3RvbUZvbnQiLCJpZnJhbWUiLCJjb250ZW50RG9jdW1lbnQiLCJub2RlIiwicGFyZW50Tm9kZSIsImlzQm9sZCIsImlzSXRhbGljIiwiaXNVbmRlcmxpbmUiLCJmb250IiwiZm9udFNpemUiLCJhbGlnbm1lbnQiLCJsaW5lSGVpZ2h0IiwiY29sb3IiLCIkZm9udFN0eWxlIiwiJGZvbnRTaXplUGlja2VyIiwiJGFsaWdubWVudCIsImNsb3NlRHJvcGRvd25zIiwiY29udGVudHMiLCJzZWxlY3Rpb24iLCJnZXRTZWxlY3RlZE5vZGUiLCJub2RlVHlwZSIsInRhZ05hbWUiLCJ0b0xvd2VyQ2FzZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiaW5kZXhPZiIsInNldFN0eWxlcyIsImJvbGQiLCJpdGFsaWMiLCJ1bmRlcmxpbmUiLCJzZXRGb250Iiwic2V0Rm9udFNpemUiLCJpbkFycmF5Iiwic2V0QWxpZ25tZW50IiwicmVzZXQiLCJyZW1vdmVDbGFzcyIsInJlc3RyaWN0Iiwic2NvcGUiXSwibWFwcGluZ3MiOiJDQUVDLFdBQ0MsWUFFQUEsU0FBUUMsT0FBTyx5Q0FDWkMsVUFBVSxZQUFhLFdBTXRCLFFBQVNDLEdBQUtDLEVBQVFDLEdBQ3BCLEdBQUlDLEdBQWtCLEtBQU1DLEVBQU8sSUFFbkNDLEdBQUVILEdBQVNJLFdBQ1RDLFlBQWVOLEVBQU9NLGNBR3hCQyxFQUFjSCxFQUFFLGdCQUNoQkksRUFBbUJKLEVBQUUscUJBQ3JCSyxFQUFhTCxFQUFFLGVBQ2ZNLEVBQWtCTixFQUFFLG9CQUNwQk8sRUFBU1AsRUFBRSxhQUFhUSxLQUFLLGFBQWFELE9BRzFDWCxFQUFPYSxJQUFJLHVCQUF3QixTQUFVQyxFQUFHQyxHQUM5Q0MsR0FBaUIsRUFDakJDLEVBQVNGLEVBRVRKLEVBQU9PLFNBQVNILEVBQWlCSCxNQUc3QkcsRUFBaUJJLGFBQ25CakIsRUFBa0JrQixVQUFVTCxFQUFpQkksWUFDN0NoQixFQUFPRCxFQUFnQm1CLFFBRXZCYixFQUFpQmMsU0FBUyxNQUFPcEIsR0FFakNTLEVBQU9ZLFNBQVNDLFNBQVNDLEtBQUssa0JBQW1CdEIsSUFDN0N1QixLQUFNLHdCQUNOQyxNQUFPekIsRUFBZ0IwQixrQkFJN0JDLE1BR0Y3QixFQUFPYSxJQUFJLDBCQUEyQixXQUNwQ1gsRUFBa0JTLEVBQU9ZLFNBQVNPLElBQUlDLEtBQ25DQyxhQUFhLHlCQUVoQmhDLEVBQU9pQyxRQUFRQyxtQkFBbUIsT0FBUXZCLEVB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T0FDRXRGLFlBQWUsSUFDZmEsV0FBYyxJQUNkUCxLQUFRLEtBRVZiLEtBQU1BIiwiZmlsZSI6ImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgUmlzZVZpc2lvbiwgYW5ndWxhciwgdGlueWNvbG9yLCAkICovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGFuZ3VsYXIubW9kdWxlKFwicmlzZXZpc2lvbi53aWRnZXQuY29tbW9uLnd5c2lodG1sNVwiLCBbXSlcbiAgICAuZGlyZWN0aXZlKFwid3lzaWh0bWw1XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlZGl0b3IgPSBudWxsO1xuICAgICAgdmFyICRmb250UGlja2VyLCAkYmFja2dyb3VuZENvbG9yLCAkdGV4dENvbG9yLCAkaGlnaGxpZ2h0Q29sb3I7XG4gICAgICB2YXIgaXNFZGl0b3JMb2FkZWQgPSBmYWxzZSwgaXNQYXJhbXNMb2FkZWQgPSBmYWxzZTtcbiAgICAgIHZhciBwYXJhbXM7XG5cbiAgICAgIGZ1bmN0aW9uIGxpbmsoJHNjb3BlLCBlbGVtZW50KSB7XG4gICAgICAgIHZhciBiYWNrZ3JvdW5kQ29sb3IgPSBudWxsLCByZ2JhID0gbnVsbDtcblxuICAgICAgICAkKGVsZW1lbnQpLnd5c2lodG1sNSh7XG4gICAgICAgICAgXCJzdHlsZXNoZWV0c1wiOiAkc2NvcGUuc3R5bGVzaGVldHNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGZvbnRQaWNrZXIgPSAkKFwiLmZvbnQtcGlja2VyXCIpO1xuICAgICAgICAkYmFja2dyb3VuZENvbG9yID0gJChcIi5iYWNrZ3JvdW5kLWNvbG9yXCIpO1xuICAgICAgICAkdGV4dENvbG9yID0gJChcIi50ZXh0LWNvbG9yXCIpO1xuICAgICAgICAkaGlnaGxpZ2h0Q29sb3IgPSAkKFwiLmhpZ2hsaWdodC1jb2xvclwiKTtcbiAgICAgICAgZWRpdG9yID0gJChcIiNlZGl0YWJsZVwiKS5kYXRhKFwid3lzaWh0bWw1XCIpLmVkaXRvcjtcblxuICAgICAgICAvLyBBZGQgZXZlbnQgaGFuZGxlcnMuXG4gICAgICAgICRzY29wZS4kb24oXCJsb2FkQWRkaXRpb25hbFBhcmFtc1wiLCBmdW5jdGlvbiAoZSwgYWRkaXRpb25hbFBhcmFtcykge1xuICAgICAgICAgIGlzUGFyYW1zTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICBwYXJhbXMgPSBhZGRpdGlvbmFsUGFyYW1zO1xuXG4gICAgICAgICAgZWRpdG9yLnNldFZhbHVlKGFkZGl0aW9uYWxQYXJhbXMuZGF0YSk7XG5cbiAgICAgICAgICAvLyBTZXQgYmFja2dyb3VuZCBjb2xvci5cbiAgICAgICAgICBpZiAoYWRkaXRpb25hbFBhcmFtcy5iYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPSB0aW55Y29sb3IoYWRkaXRpb25hbFBhcmFtcy5iYWNrZ3JvdW5kKTtcbiAgICAgICAgICAgIHJnYmEgPSBiYWNrZ3JvdW5kQ29sb3IudG9SZ2IoKTtcblxuICAgICAgICAgICAgJGJhY2tncm91bmRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBiYWNrZ3JvdW5kQ29sb3IpO1xuXG4gICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuY29tbWFuZHMuZXhlYyhcImJhY2tncm91bmRDb2xvclwiLCByZ2JhLCBbe1xuICAgICAgICAgICAgICAgIG5hbWU6IFwiZGF0YS1iYWNrZ3JvdW5kLWNvbG9yXCIsXG4gICAgICAgICAgICAgICAgdmFsdWU6IGJhY2tncm91bmRDb2xvci50b1JnYlN0cmluZygpXG4gICAgICAgICAgICAgIH1dKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpbml0RWRpdG9yKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS4kb24oXCJjb2xsZWN0QWRkaXRpb25hbFBhcmFtc1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPSBlZGl0b3IuY29tcG9zZXIuZG9jLmJvZHlcbiAgICAgICAgICAgIC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIik7XG5cbiAgICAgICAgICAkc2NvcGUuJHBhcmVudC5zZXRBZGRpdGlvbmFsUGFyYW0oXCJkYXRhXCIsIGVkaXRvci5nZXRWYWx1ZSgpKTtcbiAgICAgICAgICAkc2NvcGUuJHBhcmVudC5zZXRBZGRpdGlvbmFsUGFyYW0oXCJiYWNrZ3JvdW5kXCIsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPyBiYWNrZ3JvdW5kQ29sb3IgOiBcIlwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZWRpdG9yLm9uKFwibG9hZFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpc0VkaXRvckxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgYmluZCgpO1xuICAgICAgICAgIGluaXRFZGl0b3IoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGluaXRFZGl0b3IoKSB7XG4gICAgICAgIHZhciB0ZXh0Q29sb3IsIGhpZ2hsaWdodENvbG9yO1xuICAgICAgICB2YXIgc3RhbmRhcmRGb250LCBnb29nbGVGb250LCBjdXN0b21Gb250O1xuXG4gICAgICAgIGlmIChpc0VkaXRvckxvYWRlZCAmJiBpc1BhcmFtc0xvYWRlZCkge1xuICAgICAgICAgICQuZWFjaCgkKFwiPGRpdi8+XCIpLmh0bWwocGFyYW1zLmRhdGEpLmZpbmQoXCJzcGFuXCIpLmFkZEJhY2soKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdGFuZGFyZEZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnRcIik7XG4gICAgICAgICAgICBnb29nbGVGb250ID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1nb29nbGUtZm9udFwiKTtcbiAgICAgICAgICAgIGN1c3RvbUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250XCIpO1xuICAgICAgICAgICAgdGV4dENvbG9yID0gJCh0aGlzKS5hdHRyKFwiZGF0YS10ZXh0LWNvbG9yXCIpO1xuICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWhpZ2hsaWdodC1jb2xvclwiKTtcblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3Igc3RhbmRhcmQgZm9udHMuXG4gICAgICAgICAgICBpZiAoc3RhbmRhcmRGb250KSB7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwic3RhbmRhcmRGb250XCIsIHN0YW5kYXJkRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnQtZmFtaWx5XCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hZCBhbmQgYWRkIENTUyBmb3IgR29vZ2xlIGZvbnRzLlxuICAgICAgICAgICAgaWYgKGdvb2dsZUZvbnQpIHtcbiAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpXG4gICAgICAgICAgICAgICAgLmFkZEdvb2dsZUZvbnQoZ29vZ2xlRm9udCwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgIC8vIFRoaXMgd29uJ3QgYWRkIGEgbmV3IHNwYW4gdGFnIGJlY2F1c2UgYSByYW5nZSB3aWxsIG5vdCBoYXZlXG4gICAgICAgICAgICAgIC8vIGJlZW4gc2VsZWN0ZWQsIHdoaWNoIGlzIHdoYXQgd2Ugd2FudC5cbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJnb29nbGVGb250XCIsIGdvb2dsZUZvbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBjdXN0b20gZm9udHMuXG4gICAgICAgICAgICBpZiAoY3VzdG9tRm9udCkge1xuICAgICAgICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5VdGlsaXRpZXMubG9hZEN1c3RvbUZvbnQoY3VzdG9tRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250LXVybFwiKSxcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuaWZyYW1lLmNvbnRlbnREb2N1bWVudCk7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiY3VzdG9tRm9udFwiLCBjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3IgY29sb3JzLlxuICAgICAgICAgICAgaWYgKHRleHRDb2xvcikge1xuICAgICAgICAgICAgICAvLyBVc2UgY29sb3IgcGlja2VyIGFzIGFuIGludGVybWVkaWFyeSB0byBnZXQgdGhlIGNvbG9yIGFzIGFuXG4gICAgICAgICAgICAgIC8vIG9iamVjdCBmb3IgcGFzc2luZyB0byB0aGUgZWRpdG9yIGNvbW1hbmQuXG4gICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgdGV4dENvbG9yKTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJ0ZXh0Q29sb3JcIixcbiAgICAgICAgICAgICAgICAkdGV4dENvbG9yLnNwZWN0cnVtKFwiZ2V0XCIpLnRvUmdiKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgLy8gVXNlIGNvbG9yIHBpY2tlciBhcyBhbiBpbnRlcm1lZGlhcnkuXG4gICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiaGlnaGxpZ2h0Q29sb3JcIixcbiAgICAgICAgICAgICAgICAkaGlnaGxpZ2h0Q29sb3Iuc3BlY3RydW0oXCJnZXRcIikudG9SZ2IoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYmluZCgpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBudWxsLCBwYXJlbnROb2RlID0gbnVsbDtcbiAgICAgICAgdmFyIGlzQm9sZCA9IGZhbHNlLCBpc0l0YWxpYyA9IGZhbHNlLCBpc1VuZGVybGluZSA9IGZhbHNlO1xuICAgICAgICB2YXIgZm9udCA9IFwiXCIsIGZvbnRTaXplID0gXCJcIiwgYWxpZ25tZW50ID0gXCJcIiwgbGluZUhlaWdodCA9IFwiXCI7XG4gICAgICAgIHZhciBjb2xvciA9IFwiXCIsIGhpZ2hsaWdodENvbG9yID0gXCJcIjtcbiAgICAgICAgdmFyICRmb250U3R5bGUgPSAkKFwiLmVtcGhhc2lzXCIpXG4gICAgICAgIHZhciAkZm9udFNpemVQaWNrZXIgPSAkKFwiLmZvbnQtc2l6ZS1waWNrZXJcIik7XG4gICAgICAgIHZhciAkYWxpZ25tZW50ID0gJChcIi5hbGlnbm1lbnRcIik7XG5cbiAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzIHRvIHRvb2xiYXIgYW5kIGVkaXRvci5cbiAgICAgICAgJChcIi5mb250LXBpY2tlclwiKS5vbihcInNob3cuYmZoc2VsZWN0Ym94XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIuZm9udC1zaXplLXBpY2tlciwgLmxpbmUtaGVpZ2h0LCAuYWxpZ25tZW50XCIpLm9uKFwic2hvdy5icy5kcm9wZG93blwiLFxuICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgJChcIi50ZXh0LWNvbG9yLCAuaGlnaGxpZ2h0LWNvbG9yLCAuYmFja2dyb3VuZC1jb2xvclwiKVxuICAgICAgICAgIC5vbihcImJlZm9yZVNob3dcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBXaGVuIHRoZSB1c2VyIGNsaWNrcyBpbiB0aGUgZWRpdG9yLCBzZXQgdG9vbGJhciB0byBtYXRjaCB0ZXh0IHN0eWxlcy5cbiAgICAgICAgJChcIi53eXNpaHRtbDUtc2FuZGJveFwiKS5jb250ZW50cygpLmZpbmQoXCJib2R5XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcblxuICAgICAgICAgIG5vZGUgPSBlZGl0b3IuY29tcG9zZXIuc2VsZWN0aW9uLmdldFNlbGVjdGVkTm9kZSgpO1xuXG4gICAgICAgICAgLy8gVGhlIHNlbGVjdGVkIG5vZGUgaXMgYSB0ZXh0IG5vZGUuXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIGFuIGVsZW1lbnQuXG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgIC8vIFRoZSBwYXJlbnQgbm9kZSBpcyBub3QgdGhlIGVkaXRvciBlbGVtZW50IGl0c2VsZi5cbiAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcImJvZHlcIikge1xuICAgICAgICAgICAgICAgIC8vIEZvbnQgU3R5bGVcbiAgICAgICAgICAgICAgICBpc0JvbGQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXdlaWdodFwiKSA9PT0gXCJib2xkXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNJdGFsaWMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXN0eWxlXCIpID09PSBcIml0YWxpY1wiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzVW5kZXJsaW5lID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwidGV4dC1kZWNvcmF0aW9uXCIpLmluZGV4T2YoXCJ1bmRlcmxpbmVcIikgIT09IC0xID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5zZXRTdHlsZXMoe1xuICAgICAgICAgICAgICAgICAgXCJib2xkXCI6IGlzQm9sZCxcbiAgICAgICAgICAgICAgICAgIFwiaXRhbGljXCI6IGlzSXRhbGljLFxuICAgICAgICAgICAgICAgICAgXCJ1bmRlcmxpbmVcIjogaXNVbmRlcmxpbmVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEZvbnRcbiAgICAgICAgICAgICAgICBmb250ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC1mYW1pbHlcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udCkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpLnNldEZvbnQoZm9udCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRm9udCBzaXplXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXNpemVcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICRmb250U2l6ZVBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRTaXplUGlja2VyXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGb250U2l6ZShmb250U2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQWxpZ25tZW50XG4gICAgICAgICAgICAgICAgYWxpZ25tZW50ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwidGV4dC1hbGlnblwiKTtcblxuICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGFsaWdubWVudCBpcyBvbmUgb2YgdGhlIHN1cHBvcnRlZCB2YWx1ZXMuXG4gICAgICAgICAgICAgICAgYWxpZ25tZW50ID0gJC5pbkFycmF5KGFsaWdubWVudCwgW1wibGVmdFwiLCBcImNlbnRlclwiLCBcInJpZ2h0XCIsIFwianVzdGlmeVwiXSkgPT09IC0xXG4gICAgICAgICAgICAgICAgICA/IFwibGVmdFwiIDogYWxpZ25tZW50O1xuXG4gICAgICAgICAgICAgICAgaWYgKGFsaWdubWVudCkge1xuICAgICAgICAgICAgICAgICAgJGFsaWdubWVudC5kYXRhKFwicGx1Z2luX2FsaWdubWVudFwiKVxuICAgICAgICAgICAgICAgICAgICAuc2V0QWxpZ25tZW50KGFsaWdubWVudCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gTGluZSBIZWlnaHRcbiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgP1xuICAgICAgICAgICAgICAgICAgJChwYXJlbnROb2RlKS5kYXRhKFwibGluZS1oZWlnaHRcIikgOiAxO1xuXG4gICAgICAgICAgICAgICAgJChcIi5saW5lLWhlaWdodCBidXR0b25cIikuZGF0YShcInd5c2lodG1sNS1jb21tYW5kLXZhbHVlXCIsXG4gICAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIC8vIENvbG9yc1xuICAgICAgICAgICAgICAgIGNvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiY29sb3JcIik7XG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJiYWNrZ3JvdW5kLWNvbG9yXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAkdGV4dENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGNvbG9yKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGFsbCB0b29sYmFyIGljb25zLlxuICAgICAgICAgICAgICAgICRmb250UGlja2VyLmRhdGEoXCJwbHVnaW5fZm9udFBpY2tlclwiKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICRmb250U2l6ZVBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRTaXplUGlja2VyXCIpLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5yZXNldCgpO1xuICAgICAgICAgICAgICAgICRhbGlnbm1lbnQuZGF0YShcInBsdWdpbl9hbGlnbm1lbnRcIikucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAkKFwiLmxpbmUtaGVpZ2h0IGJ1dHRvblwiKS5kYXRhKFwid3lzaWh0bWw1LWNvbW1hbmQtdmFsdWVcIiwgXCIxXCIpO1xuICAgICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgXCIjMDAwXCIpO1xuICAgICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBcIiNmZmZcIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDbG9zZSBhbGwgb3BlbiBkcm9wZG93bnMuXG4gICAgICBmdW5jdGlvbiBjbG9zZURyb3Bkb3ducygpIHtcbiAgICAgICAgJChcIi5vcGVuLmFsaWdubWVudCwgLmZvbnQtcGlja2VyIC5vcGVuLmJmaC1zZWxlY3Rib3gsIFwiICtcbiAgICAgICAgICBcIi5mb250LXNpemUtcGlja2VyIC5vcGVuLmJmaC1mb250c2l6ZXMsIC5vcGVuLmxpbmUtaGVpZ2h0XCIpXG4gICAgICAgICAgLnJlbW92ZUNsYXNzKFwib3BlblwiKTtcbiAgICAgICAgJChcIi50ZXh0LWNvbG9yXCIpLnNwZWN0cnVtKFwiaGlkZVwiKTtcbiAgICAgICAgJChcIi5oaWdobGlnaHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmJhY2tncm91bmQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBXCIsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgXCJzdHlsZXNoZWV0c1wiOiBcIj1cIixcbiAgICAgICAgICBcImJhY2tncm91bmRcIjogXCI9XCIsXG4gICAgICAgICAgXCJkYXRhXCI6IFwiPVwiXG4gICAgICAgIH0sXG4gICAgICAgIGxpbms6IGxpbmtcbiAgICAgIH07XG4gICAgfSk7XG59KCkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9