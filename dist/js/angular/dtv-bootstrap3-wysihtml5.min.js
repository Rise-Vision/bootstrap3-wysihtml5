!function(){"use strict";angular.module("risevision.widget.common.wysihtml5",[]).directive("wysihtml5",function(){function t(t,n){var m=null,g=null;$(n).wysihtml5({stylesheets:t.stylesheets}),a=$(".font-picker"),l=$(".background-color"),i=$(".text-color"),r=$(".highlight-color"),c=$("#editable").data("wysihtml5").editor,t.$on("loadAdditionalParams",function(t,o){u=!0,d=o,c.setValue(o.data),o.background&&(m=tinycolor(o.background),g=m.toRgb(),l.spectrum("set",m),c.composer.commands.exec("backgroundColor",g,[{name:"data-background-color",value:m.toRgbString()}])),e()}),t.$on("collectAdditionalParams",function(){m=c.composer.doc.body.getAttribute("data-background-color"),t.$parent.setAdditionalParam("data",c.getValue()),t.$parent.setAdditionalParam("background",m?m:"")}),c.on("load",function(){s=!0,o(),e()})}function e(){var t,e,o,n,l;s&&u&&$.each($(d.data).find("span").addBack(),function(){o=$(this).attr("data-standard-font"),n=$(this).attr("data-google-font"),l=$(this).attr("data-custom-font"),t=$(this).attr("data-text-color"),e=$(this).attr("data-highlight-color"),o&&c.composer.commands.exec("standardFont",o,$(this).attr("data-standard-font-family")),n&&(a.data("plugin_fontPicker").addGoogleFont(n,!1),c.composer.commands.exec("googleFont",n)),l&&(RiseVision.Common.Utilities.loadCustomFont(l,$(this).attr("data-custom-font-url"),c.composer.iframe.contentDocument),c.composer.commands.exec("customFont",l,$(this).attr("data-custom-font-url"))),t&&(i.spectrum("set",t),c.composer.commands.exec("textColor",i.spectrum("get").toRgb())),e&&(r.spectrum("set",e),c.composer.commands.exec("highlightColor",r.spectrum("get").toRgb()))})}function o(){var t=null,e=null,o=!1,l=!1,d=!1,s="",u="",m="",g="",p="",h="",f=$(".emphasis"),y=$(".font-size-picker"),b=$(".alignment");$(".font-picker").on("show.bfhselectbox",function(){n()}),$(".font-size-picker, .line-height, .alignment").on("show.bs.dropdown",function(){n()}),$(".text-color, .highlight-color, .background-color").on("beforeShow",function(){n()}),$(".wysihtml5-sandbox").contents().find("body").on("click",function(){n(),t=c.composer.selection.getSelectedNode(),t&&3===t.nodeType&&(e=t.parentNode,e&&1===e.nodeType&&("body"!==e.tagName.toLowerCase()?(o="bold"===window.getComputedStyle(e,null).getPropertyValue("font-weight")?!0:!1,l="italic"===window.getComputedStyle(e,null).getPropertyValue("font-style")?!0:!1,d=-1!==window.getComputedStyle(e,null).getPropertyValue("text-decoration").indexOf("underline")?!0:!1,f.data("plugin_fontStyle").setStyles({bold:o,italic:l,underline:d}),s=window.getComputedStyle(e,null).getPropertyValue("font-family"),s&&a.data("plugin_fontPicker").setFont(s),u=window.getComputedStyle(e,null).getPropertyValue("font-size"),u&&y.data("plugin_fontSizePicker").setFontSize(u),m=window.getComputedStyle(e,null).getPropertyValue("text-align"),m&&b.data("plugin_alignment").setAlignment(m),g=$(e).data("line-height")?$(e).data("line-height"):1,$(".line-height button").data("wysihtml5-command-value",g),p=window.getComputedStyle(e,null).getPropertyValue("color"),h=window.getComputedStyle(e,null).getPropertyValue("background-color"),p&&i.spectrum("set",p),h&&r.spectrum("set",h)):(f.data("plugin_fontStyle").setStyles({bold:!1,italic:!1,underline:!1}),$(".line-height button").data("wysihtml5-command-value",1))))})}function n(){$(".open.alignment, .font-picker .open.bfh-selectbox, .font-size-picker .open.bfh-fontsizes, .open.line-height").removeClass("open"),$(".text-color").spectrum("hide"),$(".highlight-color").spectrum("hide"),$(".background-color").spectrum("hide")}var a,l,i,r,d,c=null,s=!1,u=!1;return{restrict:"A",scope:{stylesheets:"=",background:"=",data:"="},link:t}})}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR0di1ib290c3RyYXAzLXd5c2lodG1sNS5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIiwibGluayIsIiRzY29wZSIsImVsZW1lbnQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJyZ2JhIiwiJCIsInd5c2lodG1sNSIsInN0eWxlc2hlZXRzIiwiJGZvbnRQaWNrZXIiLCIkYmFja2dyb3VuZENvbG9yIiwiJHRleHRDb2xvciIsIiRoaWdobGlnaHRDb2xvciIsImVkaXRvciIsImRhdGEiLCIkb24iLCJlIiwiYWRkaXRpb25hbFBhcmFtcyIsImlzUGFyYW1zTG9hZGVkIiwicGFyYW1zIiwic2V0VmFsdWUiLCJiYWNrZ3JvdW5kIiwidGlueWNvbG9yIiwidG9SZ2IiLCJzcGVjdHJ1bSIsImNvbXBvc2VyIiwiY29tbWFuZHMiLCJleGVjIiwibmFtZSIsInZhbHVlIiwidG9SZ2JTdHJpbmciLCJpbml0RWRpdG9yIiwiZG9jIiwiYm9keSIsImdldEF0dHJpYnV0ZSIsIiRwYXJlbnQiLCJzZXRBZGRpdGlvbmFsUGFyYW0iLCJnZXRWYWx1ZSIsIm9uIiwiaXNFZGl0b3JMb2FkZWQiLCJiaW5kIiwidGV4dENvbG9yIiwiaGlnaGxpZ2h0Q29sb3IiLCJzdGFuZGFyZEZvbnQiLCJnb29nbGVGb250IiwiY3VzdG9tRm9udCIsImVhY2giLCJmaW5kIiwiYWRkQmFjayIsInRoaXMiLCJhdHRyIiwiYWRkR29vZ2xlRm9udCIsIlJpc2VWaXNpb24iLCJDb21tb24iLCJVdGlsaXRpZXMiLCJsb2FkQ3VzdG9tRm9udCIsImlmcmFtZSIsImNvbnRlbnREb2N1bWVudCIsIm5vZGUiLCJwYXJlbnROb2RlIiwiaXNCb2xkIiwiaXNJdGFsaWMiLCJpc1VuZGVybGluZSIsImZvbnQiLCJmb250U2l6ZSIsImFsaWdubWVudCIsImxpbmVIZWlnaHQiLCJjb2xvciIsIiRmb250U3R5bGUiLCIkZm9udFNpemVQaWNrZXIiLCIkYWxpZ25tZW50IiwiY2xvc2VEcm9wZG93bnMiLCJjb250ZW50cyIsInNlbGVjdGlvbiIsImdldFNlbGVjdGVkTm9kZSIsIm5vZGVUeXBlIiwidGFnTmFtZSIsInRvTG93ZXJDYXNlIiwid2luZG93IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJpbmRleE9mIiwic2V0U3R5bGVzIiwiYm9sZCIsIml0YWxpYyIsInVuZGVybGluZSIsInNldEZvbnQiLCJzZXRGb250U2l6ZSIsInNldEFsaWdubWVudCIsInJlbW92ZUNsYXNzIiwicmVzdHJpY3QiLCJzY29wZSJdLCJtYXBwaW5ncyI6IkNBRUMsV0FDQyxZQUVBQSxTQUFRQyxPQUFPLHlDQUNaQyxVQUFVLFlBQWEsV0FNdEIsUUFBU0MsR0FBS0MsRUFBUUMsR0FDcEIsR0FBSUMsR0FBa0IsS0FBTUMsRUFBTyxJQUVuQ0MsR0FBRUgsR0FBU0ksV0FDVEMsWUFBZU4sRUFBT00sY0FHeEJDLEVBQWNILEVBQUUsZ0JBQ2hCSSxFQUFtQkosRUFBRSxxQkFDckJLLEVBQWFMLEVBQUUsZUFDZk0sRUFBa0JOLEVBQUUsb0JBQ3BCTyxFQUFTUCxFQUFFLGFBQWFRLEtBQUssYUFBYUQsT0FHMUNYLEVBQU9hLElBQUksdUJBQXdCLFNBQVVDLEVBQUdDLEdBQzlDQyxHQUFpQixFQUNqQkMsRUFBU0YsRUFFVEosRUFBT08sU0FBU0gsRUFBaUJILE1BRzdCRyxFQUFpQkksYUFDbkJqQixFQUFrQmtCLFVBQVVMLEVBQWlCSSxZQUM3Q2hCLEVBQU9ELEVBQWdCbUIsUUFFdkJiLEVBQWlCYyxTQUFTLE1BQU9wQixHQUVqQ1MsRUFBT1ksU0FBU0MsU0FBU0MsS0FBSyxrQkFBbUJ0QixJQUM3Q3VCLEtBQU0sd0JBQ05DLE1BQU96QixFQUFnQjBCLGtCQUk3QkMsTUFHRjdCLEVBQU9hLElBQUksMEJBQTJCLFdBQ3BDWCxFQUFrQlMsRUFBT1ksU0FBU08sSUFBSUMsS0FDbkNDLGFBQWEseUJBRWhCaEMsRUFBT2lDLFFBQVFDLG1CQUFtQixPQUFRdkIsRUFBT3dCLFlBQ2pEbkMsRUFBT2lDLFFBQVFD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SyxFQUFnQnZELEtBQUsseUJBQ2xCeUUsWUFBWXZCLEdBSWpCQyxFQUFZYSxPQUFPQyxpQkFBaUJwQixFQUFZLE1BQzdDcUIsaUJBQWlCLGNBRWhCZixHQUNGSyxFQUFXeEQsS0FBSyxvQkFDYjBFLGFBQWF2QixHQUlsQkMsRUFBYTVELEVBQUVxRCxHQUFZN0MsS0FBSyxlQUM5QlIsRUFBRXFELEdBQVk3QyxLQUFLLGVBQWlCLEVBRXRDUixFQUFFLHVCQUF1QlEsS0FBSywwQkFDNUJvRCxHQUdGQyxFQUFRVyxPQUFPQyxpQkFBaUJwQixFQUFZLE1BQ3pDcUIsaUJBQWlCLFNBQ3BCdEMsRUFBaUJvQyxPQUFPQyxpQkFBaUJwQixFQUFZLE1BQ2xEcUIsaUJBQWlCLG9CQUVoQmIsR0FDRnhELEVBQVdhLFNBQVMsTUFBTzJDLEdBR3pCekIsR0FDRjlCLEVBQWdCWSxTQUFTLE1BQU9rQixLQUtsQzBCLEVBQVd0RCxLQUFLLG9CQUFvQm9FLFdBQ2xDQyxNQUFRLEVBQ1JDLFFBQVUsRUFDVkMsV0FBYSxJQUlmL0UsRUFBRSx1QkFBdUJRLEtBQUssMEJBQTJCLFFBUW5FLFFBQVN5RCxLQUNQakUsRUFBRSwrR0FFQ21GLFlBQVksUUFDZm5GLEVBQUUsZUFBZWtCLFNBQVMsUUFDMUJsQixFQUFFLG9CQUFvQmtCLFNBQVMsUUFDL0JsQixFQUFFLHFCQUFxQmtCLFNBQVMsUUE3T2xDLEdBQ0lmLEdBQWFDLEVBQWtCQyxFQUFZQyxFQUUzQ08sRUFIQU4sRUFBUyxLQUVUMEIsR0FBaUIsRUFBT3JCLEdBQWlCLENBOE83QyxRQUNFd0UsU0FBVSxJQUNWQyxPQUNFbkYsWUFBZSxJQUNmYSxXQUFjLElBQ2RQLEtBQVEsS0FFVmIsS0FBTUEiLCJmaWxlIjoiZHR2LWJvb3RzdHJhcDMtd3lzaWh0bWw1Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBSaXNlVmlzaW9uLCBhbmd1bGFyLCB0aW55Y29sb3IsICQgKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgYW5ndWxhci5tb2R1bGUoXCJyaXNldmlzaW9uLndpZGdldC5jb21tb24ud3lzaWh0bWw1XCIsIFtdKVxuICAgIC5kaXJlY3RpdmUoXCJ3eXNpaHRtbDVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGVkaXRvciA9IG51bGw7XG4gICAgICB2YXIgJGZvbnRQaWNrZXIsICRiYWNrZ3JvdW5kQ29sb3IsICR0ZXh0Q29sb3IsICRoaWdobGlnaHRDb2xvcjtcbiAgICAgIHZhciBpc0VkaXRvckxvYWRlZCA9IGZhbHNlLCBpc1BhcmFtc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgdmFyIHBhcmFtcztcblxuICAgICAgZnVuY3Rpb24gbGluaygkc2NvcGUsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIGJhY2tncm91bmRDb2xvciA9IG51bGwsIHJnYmEgPSBudWxsO1xuXG4gICAgICAgICQoZWxlbWVudCkud3lzaWh0bWw1KHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6ICRzY29wZS5zdHlsZXNoZWV0c1xuICAgICAgICB9KTtcblxuICAgICAgICAkZm9udFBpY2tlciA9ICQoXCIuZm9udC1waWNrZXJcIik7XG4gICAgICAgICRiYWNrZ3JvdW5kQ29sb3IgPSAkKFwiLmJhY2tncm91bmQtY29sb3JcIik7XG4gICAgICAgICR0ZXh0Q29sb3IgPSAkKFwiLnRleHQtY29sb3JcIik7XG4gICAgICAgICRoaWdobGlnaHRDb2xvciA9ICQoXCIuaGlnaGxpZ2h0LWNvbG9yXCIpO1xuICAgICAgICBlZGl0b3IgPSAkKFwiI2VkaXRhYmxlXCIpLmRhdGEoXCJ3eXNpaHRtbDVcIikuZWRpdG9yO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBoYW5kbGVycy5cbiAgICAgICAgJHNjb3BlLiRvbihcImxvYWRBZGRpdGlvbmFsUGFyYW1zXCIsIGZ1bmN0aW9uIChlLCBhZGRpdGlvbmFsUGFyYW1zKSB7XG4gICAgICAgICAgaXNQYXJhbXNMb2FkZWQgPSB0cnVlO1xuICAgICAgICAgIHBhcmFtcyA9IGFkZGl0aW9uYWxQYXJhbXM7XG5cbiAgICAgICAgICBlZGl0b3Iuc2V0VmFsdWUoYWRkaXRpb25hbFBhcmFtcy5kYXRhKTtcblxuICAgICAgICAgIC8vIFNldCBiYWNrZ3JvdW5kIGNvbG9yLlxuICAgICAgICAgIGlmIChhZGRpdGlvbmFsUGFyYW1zLmJhY2tncm91bmQpIHtcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IHRpbnljb2xvcihhZGRpdGlvbmFsUGFyYW1zLmJhY2tncm91bmQpO1xuICAgICAgICAgICAgcmdiYSA9IGJhY2tncm91bmRDb2xvci50b1JnYigpO1xuXG4gICAgICAgICAgICAkYmFja2dyb3VuZENvbG9yLnNwZWN0cnVtKFwic2V0XCIsIGJhY2tncm91bmRDb2xvcik7XG5cbiAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiYmFja2dyb3VuZENvbG9yXCIsIHJnYmEsIFt7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJkYXRhLWJhY2tncm91bmQtY29sb3JcIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogYmFja2dyb3VuZENvbG9yLnRvUmdiU3RyaW5nKClcbiAgICAgICAgICAgICAgfV0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGluaXRFZGl0b3IoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHNjb3BlLiRvbihcImNvbGxlY3RBZGRpdGlvbmFsUGFyYW1zXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IGVkaXRvci5jb21wb3Nlci5kb2MuYm9keVxuICAgICAgICAgICAgLmdldEF0dHJpYnV0ZShcImRhdGEtYmFja2dyb3VuZC1jb2xvclwiKTtcblxuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImRhdGFcIiwgZWRpdG9yLmdldFZhbHVlKCkpO1xuICAgICAgICAgICRzY29wZS4kcGFyZW50LnNldEFkZGl0aW9uYWxQYXJhbShcImJhY2tncm91bmRcIixcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA/IGJhY2tncm91bmRDb2xvciA6IFwiXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBlZGl0b3Iub24oXCJsb2FkXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlzRWRpdG9yTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICBiaW5kKCk7XG4gICAgICAgICAgaW5pdEVkaXRvcigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gaW5pdEVkaXRvcigpIHtcbiAgICAgICAgdmFyIHRleHRDb2xvciwgaGlnaGxpZ2h0Q29sb3I7XG4gICAgICAgIHZhciBzdGFuZGFyZEZvbnQsIGdvb2dsZUZvbnQsIGN1c3RvbUZvbnQ7XG5cbiAgICAgICAgaWYgKGlzRWRpdG9yTG9hZGVkICYmIGlzUGFyYW1zTG9hZGVkKSB7XG4gICAgICAgICAgJC5lYWNoKCQocGFyYW1zLmRhdGEpLmZpbmQoXCJzcGFuXCIpLmFkZEJhY2soKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzdGFuZGFyZEZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnRcIik7XG4gICAgICAgICAgICBnb29nbGVGb250ID0gJCh0aGlzKS5hdHRyKFwiZGF0YS1nb29nbGUtZm9udFwiKTtcbiAgICAgICAgICAgIGN1c3RvbUZvbnQgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250XCIpO1xuICAgICAgICAgICAgdGV4dENvbG9yID0gJCh0aGlzKS5hdHRyKFwiZGF0YS10ZXh0LWNvbG9yXCIpO1xuICAgICAgICAgICAgaGlnaGxpZ2h0Q29sb3IgPSAkKHRoaXMpLmF0dHIoXCJkYXRhLWhpZ2hsaWdodC1jb2xvclwiKTtcblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3Igc3RhbmRhcmQgZm9udHMuXG4gICAgICAgICAgICBpZiAoc3RhbmRhcmRGb250KSB7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwic3RhbmRhcmRGb250XCIsIHN0YW5kYXJkRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLXN0YW5kYXJkLWZvbnQtZmFtaWx5XCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gTG9hZCBhbmQgYWRkIENTUyBmb3IgR29vZ2xlIGZvbnRzLlxuICAgICAgICAgICAgaWYgKGdvb2dsZUZvbnQpIHtcbiAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpXG4gICAgICAgICAgICAgICAgLmFkZEdvb2dsZUZvbnQoZ29vZ2xlRm9udCwgZmFsc2UpO1xuXG4gICAgICAgICAgICAgIC8vIFRoaXMgd29uJ3QgYWRkIGEgbmV3IHNwYW4gdGFnIGJlY2F1c2UgYSByYW5nZSB3aWxsIG5vdCBoYXZlXG4gICAgICAgICAgICAgIC8vIGJlZW4gc2VsZWN0ZWQsIHdoaWNoIGlzIHdoYXQgd2Ugd2FudC5cbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJnb29nbGVGb250XCIsIGdvb2dsZUZvbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2FkIGFuZCBhZGQgQ1NTIGZvciBjdXN0b20gZm9udHMuXG4gICAgICAgICAgICBpZiAoY3VzdG9tRm9udCkge1xuICAgICAgICAgICAgICBSaXNlVmlzaW9uLkNvbW1vbi5VdGlsaXRpZXMubG9hZEN1c3RvbUZvbnQoY3VzdG9tRm9udCxcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoXCJkYXRhLWN1c3RvbS1mb250LXVybFwiKSxcbiAgICAgICAgICAgICAgICBlZGl0b3IuY29tcG9zZXIuaWZyYW1lLmNvbnRlbnREb2N1bWVudCk7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiY3VzdG9tRm9udFwiLCBjdXN0b21Gb250LFxuICAgICAgICAgICAgICAgICQodGhpcykuYXR0cihcImRhdGEtY3VzdG9tLWZvbnQtdXJsXCIpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQWRkIENTUyBmb3IgY29sb3JzLlxuICAgICAgICAgICAgaWYgKHRleHRDb2xvcikge1xuICAgICAgICAgICAgICAvLyBVc2UgY29sb3IgcGlja2VyIGFzIGFuIGludGVybWVkaWFyeSB0byBnZXQgdGhlIGNvbG9yIGFzIGFuXG4gICAgICAgICAgICAgIC8vIG9iamVjdCBmb3IgcGFzc2luZyB0byB0aGUgZWRpdG9yIGNvbW1hbmQuXG4gICAgICAgICAgICAgICR0ZXh0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgdGV4dENvbG9yKTtcbiAgICAgICAgICAgICAgZWRpdG9yLmNvbXBvc2VyLmNvbW1hbmRzLmV4ZWMoXCJ0ZXh0Q29sb3JcIixcbiAgICAgICAgICAgICAgICAkdGV4dENvbG9yLnNwZWN0cnVtKFwiZ2V0XCIpLnRvUmdiKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaGlnaGxpZ2h0Q29sb3IpIHtcbiAgICAgICAgICAgICAgLy8gVXNlIGNvbG9yIHBpY2tlciBhcyBhbiBpbnRlcm1lZGlhcnkuXG4gICAgICAgICAgICAgICRoaWdobGlnaHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBoaWdobGlnaHRDb2xvcik7XG4gICAgICAgICAgICAgIGVkaXRvci5jb21wb3Nlci5jb21tYW5kcy5leGVjKFwiaGlnaGxpZ2h0Q29sb3JcIixcbiAgICAgICAgICAgICAgICAkaGlnaGxpZ2h0Q29sb3Iuc3BlY3RydW0oXCJnZXRcIikudG9SZ2IoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYmluZCgpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBudWxsLCBwYXJlbnROb2RlID0gbnVsbDtcbiAgICAgICAgdmFyIGlzQm9sZCA9IGZhbHNlLCBpc0l0YWxpYyA9IGZhbHNlLCBpc1VuZGVybGluZSA9IGZhbHNlO1xuICAgICAgICB2YXIgZm9udCA9IFwiXCIsIGZvbnRTaXplID0gXCJcIiwgYWxpZ25tZW50ID0gXCJcIiwgbGluZUhlaWdodCA9IFwiXCI7XG4gICAgICAgIHZhciBjb2xvciA9IFwiXCIsIGhpZ2hsaWdodENvbG9yID0gXCJcIjtcbiAgICAgICAgdmFyICRmb250U3R5bGUgPSAkKFwiLmVtcGhhc2lzXCIpXG4gICAgICAgIHZhciAkZm9udFNpemVQaWNrZXIgPSAkKFwiLmZvbnQtc2l6ZS1waWNrZXJcIik7XG4gICAgICAgIHZhciAkYWxpZ25tZW50ID0gJChcIi5hbGlnbm1lbnRcIik7XG5cbiAgICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXJzIHRvIHRvb2xiYXIgYW5kIGVkaXRvci5cbiAgICAgICAgJChcIi5mb250LXBpY2tlclwiKS5vbihcInNob3cuYmZoc2VsZWN0Ym94XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNsb3NlRHJvcGRvd25zKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIuZm9udC1zaXplLXBpY2tlciwgLmxpbmUtaGVpZ2h0LCAuYWxpZ25tZW50XCIpLm9uKFwic2hvdy5icy5kcm9wZG93blwiLFxuICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgJChcIi50ZXh0LWNvbG9yLCAuaGlnaGxpZ2h0LWNvbG9yLCAuYmFja2dyb3VuZC1jb2xvclwiKVxuICAgICAgICAgIC5vbihcImJlZm9yZVNob3dcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbG9zZURyb3Bkb3ducygpO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcblxuICAgICAgICAvLyBXaGVuIHRoZSB1c2VyIGNsaWNrcyBpbiB0aGUgZWRpdG9yLCBzZXQgdG9vbGJhciB0byBtYXRjaCB0ZXh0IHN0eWxlcy5cbiAgICAgICAgJChcIi53eXNpaHRtbDUtc2FuZGJveFwiKS5jb250ZW50cygpLmZpbmQoXCJib2R5XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2xvc2VEcm9wZG93bnMoKTtcblxuICAgICAgICAgIG5vZGUgPSBlZGl0b3IuY29tcG9zZXIuc2VsZWN0aW9uLmdldFNlbGVjdGVkTm9kZSgpO1xuXG4gICAgICAgICAgLy8gVGhlIHNlbGVjdGVkIG5vZGUgaXMgYSB0ZXh0IG5vZGUuXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgcGFyZW50Tm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgICAgICAgLy8gVGhlIHBhcmVudCBub2RlIGlzIGFuIGVsZW1lbnQuXG4gICAgICAgICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLm5vZGVUeXBlID09PSAxKSB7XG4gICAgICAgICAgICAgIC8vIFRoZSBwYXJlbnQgbm9kZSBpcyBub3QgdGhlIGVkaXRvciBlbGVtZW50IGl0c2VsZi5cbiAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpICE9PSBcImJvZHlcIikge1xuICAgICAgICAgICAgICAgIC8vIEZvbnQgU3R5bGVcbiAgICAgICAgICAgICAgICBpc0JvbGQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXdlaWdodFwiKSA9PT0gXCJib2xkXCIgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaXNJdGFsaWMgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXN0eWxlXCIpID09PSBcIml0YWxpY1wiID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlzVW5kZXJsaW5lID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwidGV4dC1kZWNvcmF0aW9uXCIpLmluZGV4T2YoXCJ1bmRlcmxpbmVcIikgIT09IC0xID8gdHJ1ZSA6IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgJGZvbnRTdHlsZS5kYXRhKFwicGx1Z2luX2ZvbnRTdHlsZVwiKS5zZXRTdHlsZXMoe1xuICAgICAgICAgICAgICAgICAgXCJib2xkXCI6IGlzQm9sZCxcbiAgICAgICAgICAgICAgICAgIFwiaXRhbGljXCI6IGlzSXRhbGljLFxuICAgICAgICAgICAgICAgICAgXCJ1bmRlcmxpbmVcIjogaXNVbmRlcmxpbmVcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEZvbnRcbiAgICAgICAgICAgICAgICBmb250ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZm9udC1mYW1pbHlcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udCkge1xuICAgICAgICAgICAgICAgICAgJGZvbnRQaWNrZXIuZGF0YShcInBsdWdpbl9mb250UGlja2VyXCIpLnNldEZvbnQoZm9udCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRm9udCBzaXplXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShwYXJlbnROb2RlLCBudWxsKVxuICAgICAgICAgICAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCJmb250LXNpemVcIik7XG5cbiAgICAgICAgICAgICAgICBpZiAoZm9udFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICRmb250U2l6ZVBpY2tlci5kYXRhKFwicGx1Z2luX2ZvbnRTaXplUGlja2VyXCIpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGb250U2l6ZShmb250U2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQWxpZ25tZW50XG4gICAgICAgICAgICAgICAgYWxpZ25tZW50ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwidGV4dC1hbGlnblwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChhbGlnbm1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICRhbGlnbm1lbnQuZGF0YShcInBsdWdpbl9hbGlnbm1lbnRcIilcbiAgICAgICAgICAgICAgICAgICAgLnNldEFsaWdubWVudChhbGlnbm1lbnQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIExpbmUgSGVpZ2h0XG4gICAgICAgICAgICAgICAgbGluZUhlaWdodCA9ICQocGFyZW50Tm9kZSkuZGF0YShcImxpbmUtaGVpZ2h0XCIpID9cbiAgICAgICAgICAgICAgICAgICQocGFyZW50Tm9kZSkuZGF0YShcImxpbmUtaGVpZ2h0XCIpIDogMTtcblxuICAgICAgICAgICAgICAgICQoXCIubGluZS1oZWlnaHQgYnV0dG9uXCIpLmRhdGEoXCJ3eXNpaHRtbDUtY29tbWFuZC12YWx1ZVwiLFxuICAgICAgICAgICAgICAgICAgbGluZUhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDb2xvcnNcbiAgICAgICAgICAgICAgICBjb2xvciA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudE5vZGUsIG51bGwpXG4gICAgICAgICAgICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcImNvbG9yXCIpO1xuICAgICAgICAgICAgICAgIGhpZ2hsaWdodENvbG9yID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSwgbnVsbClcbiAgICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiYmFja2dyb3VuZC1jb2xvclwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChjb2xvcikge1xuICAgICAgICAgICAgICAgICAgJHRleHRDb2xvci5zcGVjdHJ1bShcInNldFwiLCBjb2xvcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodENvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAkaGlnaGxpZ2h0Q29sb3Iuc3BlY3RydW0oXCJzZXRcIiwgaGlnaGxpZ2h0Q29sb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBSZXNldCBmb250IHN0eWxlLlxuICAgICAgICAgICAgICAgICRmb250U3R5bGUuZGF0YShcInBsdWdpbl9mb250U3R5bGVcIikuc2V0U3R5bGVzKHtcbiAgICAgICAgICAgICAgICAgIFwiYm9sZFwiOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIFwiaXRhbGljXCI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgXCJ1bmRlcmxpbmVcIjogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFJlc2V0IGxpbmUgaGVpZ2h0LlxuICAgICAgICAgICAgICAgICQoXCIubGluZS1oZWlnaHQgYnV0dG9uXCIpLmRhdGEoXCJ3eXNpaHRtbDUtY29tbWFuZC12YWx1ZVwiLCAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsb3NlIGFsbCBvcGVuIGRyb3Bkb3ducy5cbiAgICAgIGZ1bmN0aW9uIGNsb3NlRHJvcGRvd25zKCkge1xuICAgICAgICAkKFwiLm9wZW4uYWxpZ25tZW50LCAuZm9udC1waWNrZXIgLm9wZW4uYmZoLXNlbGVjdGJveCwgXCIgK1xuICAgICAgICAgIFwiLmZvbnQtc2l6ZS1waWNrZXIgLm9wZW4uYmZoLWZvbnRzaXplcywgLm9wZW4ubGluZS1oZWlnaHRcIilcbiAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAkKFwiLnRleHQtY29sb3JcIikuc3BlY3RydW0oXCJoaWRlXCIpO1xuICAgICAgICAkKFwiLmhpZ2hsaWdodC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICAgICQoXCIuYmFja2dyb3VuZC1jb2xvclwiKS5zcGVjdHJ1bShcImhpZGVcIik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkFcIixcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICBcInN0eWxlc2hlZXRzXCI6IFwiPVwiLFxuICAgICAgICAgIFwiYmFja2dyb3VuZFwiOiBcIj1cIixcbiAgICAgICAgICBcImRhdGFcIjogXCI9XCJcbiAgICAgICAgfSxcbiAgICAgICAgbGluazogbGlua1xuICAgICAgfTtcbiAgICB9KTtcbn0oKSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=